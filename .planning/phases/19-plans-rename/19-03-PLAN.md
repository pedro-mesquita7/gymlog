---
phase: 19-plans-rename
plan: 03
type: execute
wave: 3
depends_on: ["19-01", "19-02"]
files_modified:
  - src/components/workout/StartWorkout.test.tsx
  - src/stores/useWorkoutStore.test.ts
  - src/components/ui/ErrorCard.test.tsx
  - src/tests/__fixtures__/test-data.ts
  - src/e2e/helpers/selectors.ts
  - src/e2e/plan-crud.spec.ts
  - src/e2e/batch-logging.spec.ts
  - src/e2e/workout-rotation.spec.ts
autonomous: true

must_haves:
  truths:
    - "Unit tests pass with npx vitest run"
    - "E2E test selectors use nav-plans, btn-create-plan, plan-name-input etc."
    - "Grep audit finds zero unprotected 'Template' references in src/"
    - "TypeScript compiles with zero errors (npx tsc --noEmit)"
  artifacts:
    - path: "src/e2e/helpers/selectors.ts"
      provides: "Updated E2E selectors with plan- prefix"
      contains: "nav-plans"
    - path: "src/components/workout/StartWorkout.test.tsx"
      provides: "Unit test with Plan terminology"
      contains: "Plan"
  key_links:
    - from: "src/e2e/helpers/selectors.ts"
      to: "src/components/Navigation.tsx"
      via: "data-testid values must match"
      pattern: "nav-plans"
    - from: "src/e2e/plan-crud.spec.ts"
      to: "src/e2e/helpers/selectors.ts"
      via: "selector imports"
      pattern: "import.*selectors"
---

<objective>
Update all test files with Plan terminology, run full test suite, and perform grep audit to confirm zero unprotected Template references remain.

Purpose: Ensure the rename is complete and verified — tests pass, compiler is clean, and no stale "Template" text exists.
Output: All tests green, clean compiler, verified grep audit showing only protected strings remain.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-plans-rename/19-CONTEXT.md
@.planning/phases/19-plans-rename/19-RESEARCH.md
@.planning/phases/19-plans-rename/19-01-SUMMARY.md
@.planning/phases/19-plans-rename/19-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update unit tests and test fixtures</name>
  <files>
    src/components/workout/StartWorkout.test.tsx
    src/stores/useWorkoutStore.test.ts
    src/components/ui/ErrorCard.test.tsx
    src/tests/__fixtures__/test-data.ts
  </files>
  <action>
    **Step 1: StartWorkout.test.tsx**
    - Update imports: usePlans from hooks/usePlans, Plan type from types/plan
    - Rename mock function names: createTemplate -> createPlan, etc.
    - Update UI text assertions: "Select Template" -> "Select Plan", "Templates" -> "Plans"
    - Rename variables: mockTemplates -> mockPlans, selectedTemplate -> selectedPlan

    **Step 2: useWorkoutStore.test.ts**
    - Update parameter names in startWorkout calls: templateId -> planId
    - Update any assertions referencing template variable names
    - Note: template_id in the actual stored object STAYS (it's the protected property name)

    **Step 3: ErrorCard.test.tsx**
    - Update the feature name string from "Templates" to "Plans" if used in test assertions or mock data

    **Step 4: test-data.ts**
    - Update comment text referencing templates -> plans
    - Rename any factory function names or variable names (e.g., createTemplate -> createPlan)
    - Update type imports to use Plan from types/plan

    **Step 5: Run unit tests**
    - `npx vitest run` — all tests must pass
  </action>
  <verify>
    `npx vitest run 2>&1 | tail -5` shows all tests passing
    `grep -rn "useTemplates\|TemplateList\|TemplateCard" src/tests/ src/components/**/*.test.* src/stores/*.test.*` returns 0 hits
    `grep -ri "template" src/components/**/*.test.* src/stores/*.test.* src/tests/ --include="*.ts" --include="*.tsx" | grep -vi "template_created\|template_updated\|template_deleted\|template_archived\|template_id\|template_ids" | wc -l` returns 0 (no unprotected Template strings in test assertions)
  </verify>
  <done>
    All unit tests updated with Plan terminology and passing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update E2E tests and run full verification</name>
  <files>
    src/e2e/helpers/selectors.ts
    src/e2e/plan-crud.spec.ts
    src/e2e/batch-logging.spec.ts
    src/e2e/workout-rotation.spec.ts
  </files>
  <action>
    **Step 1: selectors.ts**
    - Rename selector constants: navTemplates -> navPlans, templateNameInput -> planNameInput, btnCreateTemplate -> btnCreatePlan, btnTemplateMenu -> btnPlanMenu, btnTemplateDelete -> btnPlanDelete, templateSelect -> planSelect
    - Update data-testid string values: `nav-templates` -> `nav-plans`, `template-name-input` -> `plan-name-input`, `btn-create-template` -> `btn-create-plan`, `btn-template-menu` -> `btn-plan-menu`, `btn-template-delete` -> `btn-plan-delete`, `template-select` -> `plan-select`

    **Step 2: plan-crud.spec.ts**
    - Update selector references to use new names from selectors.ts
    - Rename variables: templateName -> planName, etc.
    - Update comment text: "template" -> "plan"
    - Update any UI text assertions: "Templates" -> "Plans", "Create Template" -> "Create Plan"

    **Step 3: batch-logging.spec.ts**
    - Update selector references
    - Rename variables and comment text

    **Step 4: workout-rotation.spec.ts**
    - Update selector references
    - Rename variables and comment text

    **Step 5: Verify data-testid synchronization**
    For each renamed data-testid, confirm it exists in BOTH the component AND selectors.ts:
    - `grep "nav-plans" src/components/Navigation.tsx src/e2e/helpers/selectors.ts` — both files must match
    - `grep "btn-create-plan" src/components/plans/PlanList.tsx src/e2e/helpers/selectors.ts` — both match
    - `grep "plan-name-input" src/components/plans/PlanBuilder.tsx src/e2e/helpers/selectors.ts` — both match
    - `grep "btn-plan-menu" src/components/plans/PlanCard.tsx src/e2e/helpers/selectors.ts` — both match
    - `grep "btn-plan-delete" src/components/plans/PlanCard.tsx src/e2e/helpers/selectors.ts` — both match
    - `grep "plan-select" src/components/workout/StartWorkout.tsx src/e2e/helpers/selectors.ts` — both match
    If any pair is mismatched, fix before proceeding.

    **Step 6: TypeScript compile check**
    - `npx tsc --noEmit` — must return 0 errors

    **Step 7: Grep audit**
    Run: `grep -ri "template" src/ --include="*.ts" --include="*.tsx" | grep -v "node_modules"`

    Every remaining hit MUST be one of these protected patterns:
    - `'template_created'`, `'template_updated'`, `'template_deleted'`, `'template_archived'` (event_type literals)
    - `template_id` (payload property on events, WorkoutSession, fact_workouts references)
    - `template_ids` (Rotation property)
    - `payload->>'template_id'` (SQL strings)
    - `dim_templates` (dbt view name in SQL)
    - Comments explicitly noting backward compatibility

    If ANY unprotected "template"/"Template" text remains, fix it.

    **Step 8: E2E tests (if Playwright is configured)**
    - `npx playwright test` — run if available; if not configured for CI, skip but note in summary
  </action>
  <verify>
    `npx tsc --noEmit` returns 0 errors
    `grep -ri "template" src/ --include="*.ts" --include="*.tsx" | grep -vi "template_created\|template_updated\|template_deleted\|template_archived\|template_id\|template_ids\|dim_templates\|payload.*template\|// .*template\|Preserved.*template" | wc -l` returns 0
    `npx vitest run` passes
    data-testid sync: `grep "nav-plans" src/components/Navigation.tsx src/e2e/helpers/selectors.ts` returns 2 hits (one per file)
  </verify>
  <done>
    TypeScript compiles clean. Grep audit confirms only protected strings remain. Unit tests pass. E2E test files updated with Plan selectors and assertions. data-testid values confirmed synchronized between components and selectors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — 0 errors
2. `npx vitest run` — all tests pass
3. `grep -ri "template" src/ --include="*.ts" --include="*.tsx" | grep -vi "template_created\|template_updated\|template_deleted\|template_archived\|template_id\|template_ids\|dim_templates\|payload.*template\|Preserved\|backward"` — 0 unprotected hits
4. `npx playwright test` — E2E tests pass (if available)
5. Protected strings verified present: `grep -c "'template_created'" src/types/events.ts` >= 1
</verification>

<success_criteria>
- TypeScript compiles with 0 errors
- All unit tests pass (npx vitest run)
- E2E test selectors updated to plan- prefix
- Grep audit shows ZERO unprotected "template"/"Template" references in src/
- All remaining "template" strings are confirmed protected (event_type literals, payload keys, SQL strings, localStorage)
</success_criteria>

<output>
After completion, create `.planning/phases/19-plans-rename/19-03-SUMMARY.md`
</output>
