---
phase: 19-plans-rename
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/plan.ts
  - src/types/events.ts
  - src/types/workout-session.ts
  - src/db/queries.ts
  - src/db/demo-data.ts
  - src/services/toon-export.ts
  - src/hooks/usePlans.ts
  - src/hooks/useWorkoutSummary.ts
  - src/hooks/useRecentWorkout.ts
  - src/hooks/useExercises.ts
  - src/stores/useWorkoutStore.ts
  - src/stores/useRotationStore.ts
autonomous: true

must_haves:
  truths:
    - "All type exports use Plan/PlanExercise naming (not Template/TemplateExercise)"
    - "Event interface names are PlanCreatedEvent etc. but event_type literals remain 'template_created' etc."
    - "Hook is usePlans() not useTemplates(), returns createPlan/updatePlan/deletePlan/archivePlan"
    - "Store selectors/params renamed (selectNextPlan, startWorkout(planId)) but template_id/template_ids properties preserved in stored objects"
    - "All SQL strings containing payload->>'template_id' are unchanged"
    - "localStorage keys gymlog-workout and gymlog-rotations are unchanged"
  artifacts:
    - path: "src/types/plan.ts"
      provides: "Plan and PlanExercise type exports"
      contains: "export interface Plan"
    - path: "src/hooks/usePlans.ts"
      provides: "usePlans hook with CRUD operations"
      exports: ["usePlans"]
    - path: "src/types/events.ts"
      provides: "PlanCreatedEvent, PlanUpdatedEvent, PlanDeletedEvent, PlanArchivedEvent"
      contains: "PlanCreatedEvent"
  key_links:
    - from: "src/types/plan.ts"
      to: "src/types/events.ts"
      via: "PlanExercise type import"
      pattern: "import.*PlanExercise.*from.*plan"
    - from: "src/hooks/usePlans.ts"
      to: "src/types/plan.ts"
      via: "Plan type import"
      pattern: "import.*Plan.*from.*types/plan"
---

<objective>
Rename all foundation-layer "Template" symbols to "Plan" across types, events, data layer, hooks, and stores.

Purpose: Establish renamed types/hooks/stores so component layer (Plan 02) can import from correct paths.
Output: All non-component TypeScript files use "Plan" naming while preserving all protected strings (event_type literals, payload keys, SQL strings, localStorage keys).
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-plans-rename/19-CONTEXT.md
@.planning/phases/19-plans-rename/19-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename types and event interfaces</name>
  <files>
    src/types/template.ts -> src/types/plan.ts
    src/types/events.ts
    src/types/workout-session.ts
  </files>
  <action>
    **Step 1: Rename type file**
    - `git mv src/types/template.ts src/types/plan.ts`
    - In `src/types/plan.ts`: rename `TemplateExercise` -> `PlanExercise`, `Template` -> `Plan`

    **Step 2: Update events.ts**
    - Rename interface names: `TemplateCreatedEvent` -> `PlanCreatedEvent`, `TemplateUpdatedEvent` -> `PlanUpdatedEvent`, `TemplateDeletedEvent` -> `PlanDeletedEvent`, `TemplateArchivedEvent` -> `PlanArchivedEvent`
    - Update import from `'./template'` to `'./plan'`, rename imported types
    - Update the `AppEvent` union type to use new interface names
    - **PROTECT:** Keep all `event_type` string literals as `'template_created'`, `'template_updated'`, `'template_deleted'`, `'template_archived'`
    - **PROTECT:** Keep all `template_id: string` property names unchanged

    **Step 3: Add backward-compat comment to workout-session.ts**
    - If `WorkoutSession` has a `template_id` property, add comment: `// Preserved: stored in localStorage as template_id`
    - Do NOT rename the property

    **Step 4: Verify**
    - Run `npx tsc --noEmit 2>&1 | head -50` to see compiler errors (expected: broken imports in downstream files, that's fine - Plan 02/03 fixes those)
    - Verify no protected strings were changed: `grep -n "event_type:" src/types/events.ts` should still show `'template_created'` etc.
  </action>
  <verify>
    `grep -c "PlanCreatedEvent" src/types/events.ts` returns >= 1
    `grep -c "'template_created'" src/types/events.ts` returns >= 1 (protected string preserved)
    `grep -c "export interface Plan " src/types/plan.ts` returns 1
  </verify>
  <done>
    src/types/plan.ts exports Plan and PlanExercise. events.ts has PlanCreatedEvent etc. with preserved template_created event_type strings and template_id properties.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rename data layer, hooks, and stores</name>
  <files>
    src/db/queries.ts
    src/db/demo-data.ts
    src/services/toon-export.ts
    src/hooks/useTemplates.ts -> src/hooks/usePlans.ts
    src/hooks/useWorkoutSummary.ts
    src/hooks/useRecentWorkout.ts
    src/hooks/useExercises.ts
    src/stores/useWorkoutStore.ts
    src/stores/useRotationStore.ts
  </files>
  <action>
    **Step 1: Data layer renames**

    In `src/db/queries.ts`:
    - Rename function `getTemplates` -> `getPlans`
    - Update type imports from `'../types/template'` to `'../types/plan'`, rename imported types (Template -> Plan, TemplateExercise -> PlanExercise)
    - Rename any local variable names (templates -> plans, template -> plan)
    - **PROTECT:** Do NOT change any SQL strings — `payload->>'template_id'`, event_type literals, column names must stay

    In `src/db/demo-data.ts`:
    - Update type imports to use plan.ts and new type names
    - Rename local variables (templateIds -> planIds, templates -> plans, etc.)
    - **PROTECT:** Do NOT change event_type string arguments ('template_created'), do NOT change template_id in payload objects

    In `src/services/toon-export.ts`:
    - Rename interfaces (TemplateRow -> PlanRow if exists), variable names
    - Update type imports
    - **PROTECT:** Do NOT change SQL strings or `payload->>'template_id'`

    **Step 2: Hook renames**

    `git mv src/hooks/useTemplates.ts src/hooks/usePlans.ts`

    In `src/hooks/usePlans.ts`:
    - Rename function `useTemplates` -> `usePlans`
    - Rename interfaces: `CreateTemplateData` -> `CreatePlanData`, `UpdateTemplateData` -> `UpdatePlanData`, `UseTemplatesReturn` -> `UsePlansReturn`
    - Rename returned functions: `createTemplate` -> `createPlan`, `updateTemplate` -> `updatePlan`, `deleteTemplate` -> `deletePlan`, `archiveTemplate` -> `archivePlan`
    - Rename local variables (templates -> plans, template -> plan, templateId -> planId)
    - Update type imports from template -> plan
    - **PROTECT:** Keep all event_type strings as 'template_created', 'template_updated', 'template_deleted', 'template_archived'
    - **PROTECT:** Keep template_id in event payload objects (e.g., `template_id: planId`)

    In `src/hooks/useWorkoutSummary.ts`:
    - Rename parameter names (templateId -> planId, templateName -> planName) in function signatures
    - Update type imports if referencing Template types
    - **PROTECT:** Do NOT change SQL strings referencing s.template_id or fw.template_id

    In `src/hooks/useRecentWorkout.ts`:
    - Rename returned field `templateName` -> `planName` in the returned object
    - **PROTECT:** Do NOT change SQL strings — `fw.template_id`, `dim_templates` view name, etc. must stay
    - SQL alias can use `AS plan_name` if it was `AS template_name`, but the source column reference (`t.name`) stays

    In `src/hooks/useExercises.ts`:
    - Update any type imports from template -> plan if present

    **Step 3: Store renames**

    In `src/stores/useWorkoutStore.ts`:
    - Rename `startWorkout` parameter from `templateId` to `planId` (or similar)
    - Update the assignment to use new param name: `template_id: planId`
    - Rename any other template-named variables/selectors
    - **PROTECT:** Keep `template_id` property name in session object (stored in localStorage)
    - **PROTECT:** Keep localStorage key `'gymlog-workout'`

    In `src/stores/useRotationStore.ts`:
    - Rename selector `selectNextTemplate` -> `selectNextPlan`
    - Rename any other template-named variables
    - **PROTECT:** Keep `template_ids` property name on Rotation interface
    - **PROTECT:** Keep localStorage key `'gymlog-rotations'`

    **Step 4: Compile check**
    - Run `npx tsc --noEmit 2>&1 | head -80` — remaining errors should only be in component files and test files (fixed in Plans 02 and 03)
  </action>
  <verify>
    `grep -c "getPlans" src/db/queries.ts` returns >= 1
    `grep -c "usePlans" src/hooks/usePlans.ts` returns >= 1
    `grep -c "createPlan" src/hooks/usePlans.ts` returns >= 1
    `grep -c "'template_created'" src/hooks/usePlans.ts` returns >= 1 (protected)
    `grep -c "selectNextPlan" src/stores/useRotationStore.ts` returns >= 1
    `grep -c "template_ids" src/stores/useRotationStore.ts` returns >= 1 (protected property)
    `grep -rn "payload->>'template_id'" src/db/ src/services/ src/hooks/` returns matches (all preserved)
  </verify>
  <done>
    All data layer, hooks, and stores use Plan naming. Protected strings (event_types, template_id/template_ids properties, SQL strings, localStorage keys) are preserved. TypeScript errors only remain in component and test files.
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "getTemplates\|useTemplates\|selectNextTemplate" src/` — should return 0 hits (all renamed)
2. `grep -rn "'template_created'" src/` — should return hits in events.ts, usePlans.ts, demo-data.ts (protected strings preserved)
3. `grep -rn "template_id" src/types/events.ts src/stores/useWorkoutStore.ts src/stores/useRotationStore.ts` — should return hits (protected properties preserved)
4. `npx tsc --noEmit 2>&1 | grep -c "error"` — errors should only reference component/test files (fixed in Plans 02, 03)
</verification>

<success_criteria>
- src/types/plan.ts exists with Plan/PlanExercise exports
- src/hooks/usePlans.ts exists with usePlans hook
- All type, data layer, hook, and store files use "Plan" naming
- Zero protected strings changed (event_type literals, template_id properties, SQL strings, localStorage keys)
- TypeScript compiler errors limited to component and test files only
</success_criteria>

<output>
After completion, create `.planning/phases/19-plans-rename/19-01-SUMMARY.md`
</output>
