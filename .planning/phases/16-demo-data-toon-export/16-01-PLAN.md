---
phase: 16-demo-data-toon-export
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/settings/DemoDataSection.tsx
  - src/utils/clearAllData.ts
  - src/components/ui/Dialog.tsx
autonomous: true

must_haves:
  truths:
    - "Import demo data button has distinct gradient/warning styling"
    - "Clear Historical Data wipes workout data while keeping exercises and gyms"
    - "Both import and clear require explicit confirmation dialog before executing"
  artifacts:
    - path: "src/components/settings/DemoDataSection.tsx"
      provides: "Demo data import and selective clear with Dialog confirmations"
      contains: "Dialog"
    - path: "src/utils/clearAllData.ts"
      provides: "clearHistoricalData function for selective wipe"
      exports: ["clearAllData", "clearHistoricalData"]
  key_links:
    - from: "src/components/settings/DemoDataSection.tsx"
      to: "src/utils/clearAllData.ts"
      via: "clearHistoricalData import"
      pattern: "clearHistoricalData"
    - from: "src/components/settings/DemoDataSection.tsx"
      to: "src/components/ui/Dialog.tsx"
      via: "Dialog component for confirmations"
      pattern: "<Dialog"
---

<objective>
Refactor DemoDataSection to use proper confirmation dialogs and destructive-action styling, and add selective historical data clearing that preserves exercises and gyms.

Purpose: Portfolio reviewers need clear visual signals for destructive actions (not browser `window.confirm`), and "Clear Historical Data" should be a safe reset that keeps exercise/gym definitions intact.
Output: Updated DemoDataSection with Dialog-based confirmations, warning gradient on import button, destructive red on clear button, and a new `clearHistoricalData()` utility.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-demo-data-toon-export/16-CONTEXT.md
@.planning/phases/16-demo-data-toon-export/16-RESEARCH.md
@src/components/settings/DemoDataSection.tsx
@src/utils/clearAllData.ts
@src/components/ui/Dialog.tsx
@src/components/backup/BackupSettings.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add clearHistoricalData utility and refactor DemoDataSection with Dialog confirmations</name>
  <files>
    src/utils/clearAllData.ts
    src/components/settings/DemoDataSection.tsx
  </files>
  <action>
**In src/utils/clearAllData.ts:**

Add a new exported function `clearHistoricalData()` alongside the existing `clearAllData()`. This function selectively deletes workout data while preserving exercise and gym definitions.

Use whitelist approach for the DELETE query:
```sql
DELETE FROM events WHERE event_type NOT IN (
  'exercise_created', 'exercise_updated', 'exercise_deleted',
  'gym_created', 'gym_updated', 'gym_deleted'
)
```

After the SQL delete, clear these localStorage keys: `gymlog-workout`, `gymlog-rotations`, `gymlog-backup`, `gymlog-progression-alerts`, `gymlog-volume-thresholds`, `gymlog-analytics-timerange`. Then call `checkpoint()` from `../../db/duckdb-init` and reload the page.

Do NOT drop the events table or clear OPFS -- just delete rows. Import `getDuckDB` and `checkpoint` from `../db/duckdb-init`.

**In src/components/settings/DemoDataSection.tsx:**

1. Replace both `window.confirm()` calls with the existing `Dialog` component from `../ui/Dialog.tsx`.

2. Add two state variables: `showImportDialog` (boolean) and `showClearDialog` (boolean).

3. For the Import Demo Data button:
   - Apply warning gradient styling using OKLCH. Use `bg-gradient-to-r` from a warm amber/orange gradient: `from-[oklch(0.65_0.18_60)] to-[oklch(0.60_0.15_35)]` with white text. This signals a one-time destructive action distinct from normal accent buttons.
   - On click: if `eventCount > 0`, set `showImportDialog = true`. If `eventCount === 0`, proceed directly.
   - Dialog content: title "Replace All Data?", body "This will replace all your data with demo data. This cannot be undone.", buttons "Cancel" and "Confirm" (confirm button uses same gradient styling).

4. For the Clear Historical Data button (rename from "Clear All Data"):
   - Change the heading to "Clear Historical Data"
   - Change description to "Remove all workout logs, plans, and templates. Exercises and gyms will be kept."
   - On click: set `showClearDialog = true`.
   - Dialog content: title "Clear Historical Data?", body "This will delete all workout data. Exercises and gyms will be kept. Cannot be undone.", buttons "Cancel" and "Clear Data" (clear button uses `bg-error` styling).
   - On confirm: call `clearHistoricalData()` instead of `clearAllData()`.

5. Import `clearHistoricalData` from `../../utils/clearAllData` alongside `clearAllData` (keep clearAllData import for potential future use). Import `Dialog` from `../ui/Dialog`.

6. Add Dialog action buttons inside Dialog children -- two buttons in a flex row: Cancel (bg-bg-tertiary) and the action button. Cancel calls the respective `setShow*Dialog(false)`.

7. Keep existing `data-testid` attributes (`btn-load-demo`, `btn-clear-data`).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles. Run `npm run build` to confirm no build errors. Visually inspect that DemoDataSection imports Dialog and clearHistoricalData correctly by reading the output file.
  </verify>
  <done>
DemoDataSection uses Dialog component for both confirmations (no window.confirm). Import button has warning gradient styling. Clear button triggers clearHistoricalData (selective wipe preserving exercises/gyms). Both dialogs have Cancel + action buttons.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` succeeds
3. DemoDataSection.tsx contains `<Dialog` (not `window.confirm`)
4. clearAllData.ts exports both `clearAllData` and `clearHistoricalData`
5. clearHistoricalData SQL uses `NOT IN` whitelist for exercise/gym event types
6. Import button has gradient classes (`bg-gradient-to-r`)
</verification>

<success_criteria>
- Import demo data shows Dialog confirmation with gradient warning button
- Clear Historical Data shows Dialog confirmation with red destructive button
- clearHistoricalData deletes workout events but preserves exercise_created/updated/deleted and gym_created/updated/deleted events
- Both existing data-testid attributes preserved
- TypeScript compiles and build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/16-demo-data-toon-export/16-01-SUMMARY.md`
</output>
