---
phase: 12-bug-fix-security
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - .gitignore
  - .planning/phases/12-bug-fix-security/SECURITY-AUDIT.md
autonomous: true

must_haves:
  truths:
    - "No secrets, API keys, or PII exist in git history, .env files, localStorage, or demo data fixtures"
    - ".gitignore covers all sensitive and generated files (coverage/, playwright-report/, test-results/, claude/, dbt/.user.yml)"
  artifacts:
    - path: ".gitignore"
      provides: "Complete coverage of sensitive and generated files"
      contains: "coverage/"
    - path: ".planning/phases/12-bug-fix-security/SECURITY-AUDIT.md"
      provides: "Written security audit report documenting findings and remediation"
      contains: "Findings"
  key_links:
    - from: ".gitignore"
      to: "git rm --cached"
      via: "Remove previously tracked files after adding to .gitignore"
      pattern: "git rm.*--cached"
---

<objective>
Complete SEC-01, SEC-04, and SEC-05: Run gitleaks to scan full git history for secrets, verify no PII in demo data, update .gitignore with missing entries, clean tracked files, and produce SECURITY-AUDIT.md report.

Purpose: No security holes exist -- secrets scanned, PII checked, generated files excluded from repo.
Output: Updated .gitignore, cleaned git index, SECURITY-AUDIT.md portfolio artifact.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-bug-fix-security/12-RESEARCH.md

@.gitignore
@src/db/demo-data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update .gitignore and clean tracked files</name>
  <files>.gitignore</files>
  <action>
  Add the following missing entries to `.gitignore` (append after the existing editor section):

  ```
  # Test output
  coverage/
  playwright-report/
  test-results/

  # AI/agent cache
  claude/

  # dbt user config
  dbt/.user.yml

  # Environment variants
  .env.*

  # Build artifacts
  *.tgz
  ```

  After updating .gitignore, remove any of these that are currently tracked by git:
  - Run `git rm -r --cached coverage/` (if tracked)
  - Run `git rm -r --cached playwright-report/` (if tracked)
  - Run `git rm -r --cached test-results/` (if tracked)
  - Run `git rm -r --cached claude/` (if tracked)
  - Run `git rm --cached dbt/.user.yml` (if tracked)

  Use `git ls-files --cached` to check which of these are actually tracked before running rm. Only rm files that are tracked.
  </action>
  <verify>
  - `git status` shows .gitignore as modified
  - `git ls-files --cached coverage/ playwright-report/ test-results/ claude/ dbt/.user.yml` returns empty (no longer tracked)
  - The .gitignore file contains all required entries
  </verify>
  <done>.gitignore covers coverage/, playwright-report/, test-results/, claude/, dbt/.user.yml, .env.*, *.tgz. Previously tracked files removed from git index.</done>
</task>

<task type="auto">
  <name>Task 2: Run security scan and produce SECURITY-AUDIT.md</name>
  <files>.planning/phases/12-bug-fix-security/SECURITY-AUDIT.md</files>
  <action>
  1. **SEC-01: Git history secret scan**
     - Attempt to install and run gitleaks: Try `docker run -v $(pwd):/path ghcr.io/gitleaks/gitleaks:latest detect --source /path --verbose` or download the binary from GitHub releases
     - If gitleaks is not available (no Docker, binary download fails), fall back to manual grep patterns:
       ```
       git log -p --all | grep -iE "(api[_-]?key|secret|password|token|private[_-]?key|auth)" | head -50
       ```
     - Record findings (expect: no secrets found based on research)

  2. **SEC-04: PII verification**
     - Review `src/db/demo-data.ts` for any personal names, emails, phone numbers, addresses
     - Check any test fixtures (*.test.tsx, *.spec.ts) for real user data
     - Record findings (expect: no PII, only generic gym names and standard exercises)

  3. **SEC-01: localStorage audit**
     - Grep codebase for `localStorage.setItem` and `localStorage.getItem` calls
     - Document what is stored (workout data, error logs, UI state)
     - Verify no secrets or PII are stored

  4. **Write SECURITY-AUDIT.md** with this structure:
     ```markdown
     # Security Audit Report - GymLog v1.3

     **Date:** [today]
     **Scope:** SEC-01, SEC-04, SEC-05

     ## Executive Summary
     [1-2 sentences]

     ## Findings

     ### SEC-01: Secrets in Code & Git History
     **Status:** [PASS/FAIL]
     **Method:** [gitleaks / manual grep]
     **Result:** [findings]

     ### SEC-04: PII in Demo Data & Fixtures
     **Status:** [PASS/FAIL]
     **Files Checked:** [list]
     **Result:** [findings]

     ### SEC-05: .gitignore Coverage
     **Status:** [PASS/FAIL]
     **Added:** [list of new entries]
     **Previously Tracked Files Cleaned:** [list]

     ### localStorage Contents
     **Status:** [PASS/FAIL]
     **Keys Found:** [list with purpose]

     ## Accepted Risks
     [Any known issues accepted per policy]

     ## Recommendations
     [Future improvements]
     ```

  This report is a portfolio artifact -- write it professionally with clear findings, not just checkboxes.
  </action>
  <verify>
  - SECURITY-AUDIT.md exists at `.planning/phases/12-bug-fix-security/SECURITY-AUDIT.md`
  - Report covers SEC-01 (secrets scan), SEC-04 (PII check), SEC-05 (.gitignore)
  - Report includes method used, findings, and status for each check
  </verify>
  <done>SECURITY-AUDIT.md documents all findings: no secrets in git history, no PII in demo data, .gitignore fully covering sensitive/generated files. Portfolio-quality artifact.</done>
</task>

</tasks>

<verification>
- .gitignore updated with all missing entries
- No previously tracked generated files remain in git index
- SECURITY-AUDIT.md exists with professional findings
- No secrets or PII found (or remediated if found)
</verification>

<success_criteria>
Full security audit completed and documented. .gitignore covers all sensitive and generated files. SECURITY-AUDIT.md serves as a portfolio artifact demonstrating security awareness.
</success_criteria>

<output>
After completion, create `.planning/phases/12-bug-fix-security/12-03-SUMMARY.md`
</output>
