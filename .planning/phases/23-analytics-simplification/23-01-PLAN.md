---
phase: 23-analytics-simplification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/analytics/AnalyticsPage.tsx
  - src/components/analytics/SummaryStatsCards.tsx
  - src/types/analytics.ts
  - src/db/compiled-queries.ts
  - src/hooks/useAnalytics.ts
  - src/components/analytics/ComparisonSection.tsx (DELETE)
  - src/components/analytics/ComparisonStatCard.tsx (DELETE)
  - src/components/analytics/ExerciseMultiSelect.tsx (DELETE)
  - src/components/analytics/ProgressionDashboard.tsx (DELETE)
  - src/components/analytics/ProgressionStatusCard.tsx (DELETE)
  - src/components/analytics/WeekComparisonCard.tsx (DELETE)
  - src/components/analytics/SectionHeading.tsx (DELETE)
  - src/hooks/useProgressionStatus.ts (DELETE)
  - src/hooks/useComparisonStats.ts (DELETE)
  - dbt/models/marts/analytics/vw_weekly_comparison.sql (DELETE if not used elsewhere)
autonomous: true

must_haves:
  truths:
    - "Comparison section is gone from the analytics page"
    - "Progression dashboard is gone from the analytics page"
    - "WeekComparisonCard is gone from the analytics page"
    - "Exercise progress charts still render with data"
    - "Volume bar chart and muscle heat map still render"
    - "Time range picker still works and persists selection"
    - "Summary stats show 3 cards (Workouts, Volume, PRs) not 4"
    - "All sections are collapsible using CollapsibleSection component"
    - "Section order is: Summary Stats, Exercise Progress, PRs, Volume, Heat Map"
  artifacts:
    - path: "src/components/analytics/AnalyticsPage.tsx"
      provides: "Simplified analytics layout with collapsible sections"
      contains: "CollapsibleSection"
    - path: "src/components/analytics/SummaryStatsCards.tsx"
      provides: "3-card summary stats (no streak)"
  key_links:
    - from: "src/components/analytics/AnalyticsPage.tsx"
      to: "CollapsibleSection"
      via: "import from ./CollapsibleSection"
      pattern: "CollapsibleSection"
    - from: "src/components/analytics/AnalyticsPage.tsx"
      to: "ExerciseProgressChart"
      via: "exercise progress section still wired"
      pattern: "ExerciseProgressChart"
---

<objective>
Remove comparison section, progression dashboard, and week comparison card from the analytics page. Delete all dead code (components, hooks, types, SQL). Restructure the analytics page layout with collapsible sections in the new order: Summary Stats -> Exercise Progress -> PRs -> Volume -> Heat Map. Update summary stats from 4 cards to 3 (drop streak).

Purpose: Simplify analytics to focus on what matters -- exercise progress and volume. Remove underused features that add complexity without value.
Output: Cleaned analytics page with fewer sections, deleted dead code files, simplified types.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-analytics-simplification/23-CONTEXT.md
@src/components/analytics/AnalyticsPage.tsx
@src/types/analytics.ts
@src/db/compiled-queries.ts
@src/hooks/useAnalytics.ts
@src/hooks/useProgressionStatus.ts
@src/hooks/useComparisonStats.ts
@src/components/analytics/ComparisonSection.tsx
@src/components/analytics/ProgressionDashboard.tsx
@src/components/analytics/WeekComparisonCard.tsx
@src/components/analytics/SummaryStatsCards.tsx
@src/components/analytics/CollapsibleSection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete dead code files and clean up references</name>
  <files>
    src/components/analytics/ComparisonSection.tsx (DELETE)
    src/components/analytics/ComparisonStatCard.tsx (DELETE)
    src/components/analytics/ExerciseMultiSelect.tsx (DELETE)
    src/components/analytics/ProgressionDashboard.tsx (DELETE)
    src/components/analytics/ProgressionStatusCard.tsx (DELETE)
    src/components/analytics/WeekComparisonCard.tsx (DELETE)
    src/components/analytics/SectionHeading.tsx (DELETE)
    src/hooks/useProgressionStatus.ts (DELETE)
    src/hooks/useComparisonStats.ts (DELETE)
    src/types/analytics.ts
    src/db/compiled-queries.ts
    src/hooks/useAnalytics.ts
  </files>
  <action>
    1. DELETE these component files (exclusively used by removed features):
       - src/components/analytics/ComparisonSection.tsx
       - src/components/analytics/ComparisonStatCard.tsx
       - src/components/analytics/ExerciseMultiSelect.tsx (confirmed: only imported by ComparisonSection)
       - src/components/analytics/ProgressionDashboard.tsx
       - src/components/analytics/ProgressionStatusCard.tsx
       - src/components/analytics/WeekComparisonCard.tsx
       - src/components/analytics/SectionHeading.tsx (will be replaced by CollapsibleSection headers)

    2. DELETE these hook files:
       - src/hooks/useProgressionStatus.ts (only used by ProgressionDashboard and AnalyticsPage for comparison prop)
       - src/hooks/useComparisonStats.ts (only used by ComparisonSection)

    3. In src/hooks/useAnalytics.ts:
       - DELETE the entire `useWeeklyComparison` export function (lines ~101-165)
       - Remove the `WEEKLY_COMPARISON_SQL` import from compiled-queries
       - Remove the `WeeklyComparison` and `UseWeeklyComparisonReturn` type imports
       - Keep `useExerciseProgress` intact (it stays)

    4. In src/db/compiled-queries.ts:
       - DELETE the `WEEKLY_COMPARISON_SQL` constant (the raw SQL string starting ~line 354)
       - DELETE the `comparisonStatsSQL` function (~line 700-783)
       - KEEP `progressionStatusSQL` function and `PROGRESSION_STATUS_SQL` constant (used by useExerciseProgression in workout UI)
       - Audit: check if `vw_progression_status.sql` dbt model is referenced at runtime. If the SQL is inlined in compiled-queries (it is), the dbt model is build-time only -- leave it for now (Phase 27 cleanup).

    5. In src/types/analytics.ts:
       - DELETE `ComparisonStats` interface
       - DELETE `UseComparisonStatsReturn` interface
       - DELETE `WeeklyComparison` interface (will rebuild simpler version in Plan 02)
       - DELETE `UseWeeklyComparisonReturn` interface
       - KEEP `ProgressionStatus` and related types (used by ProgressionAlert in workout UI)
       - KEEP `UseExerciseProgressionReturn` (used by useExerciseProgression)

    IMPORTANT: Do NOT delete useExerciseProgression.ts, ProgressionAlert.tsx, or useProgressionAlertStore.ts -- these are used in the workout SetLogger, not analytics.
  </action>
  <verify>
    Run `npx tsc --noEmit` -- should pass with no errors referencing deleted files.
    Run `grep -r "ComparisonSection\|ProgressionDashboard\|WeekComparisonCard\|useProgressionStatus\|useComparisonStats\|useWeeklyComparison\|SectionHeading" src/ --include="*.ts" --include="*.tsx"` -- should return zero results (except this plan file).
  </verify>
  <done>All dead code files deleted. No dangling imports. TypeScript compiles cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Restructure AnalyticsPage layout with collapsible sections</name>
  <files>
    src/components/analytics/AnalyticsPage.tsx
    src/components/analytics/SummaryStatsCards.tsx
    src/hooks/useSummaryStats.ts
  </files>
  <action>
    1. Rewrite AnalyticsPage.tsx with simplified layout. New section order per CONTEXT.md:
       - Time Range Picker (sticky or inline -- Claude's discretion based on simplified feel)
       - Summary Stats (not collapsible -- always visible)
       - Exercise Progress section (collapsible, default open): exercise selector dropdown + ExerciseProgressChart
       - PRs section (collapsible, default open): PRListCard
       - Volume Overview section (collapsible, default open): VolumeBarChart + VolumeLegend
       - Training Balance section (collapsible, default open): MuscleHeatMap

    2. Use existing CollapsibleSection component for all collapsible sections. Import from './CollapsibleSection'.

    3. Remove ALL imports for deleted components/hooks:
       - Remove: ComparisonSection, WeekComparisonCard, ProgressionDashboard, SectionHeading
       - Remove: useProgressionStatus, useWeeklyComparison
       - Remove: weeklyData, weeklyLoading, weeklyError, currentWeekComparison, progressionStatusData state/memo

    4. Keep these imports and their wiring:
       - useExerciseProgress (exercise charts)
       - useVolumeAnalytics (volume bar chart + heat map)
       - useVolumeZoneThresholds (zone thresholds for heat map)
       - useSummaryStats (summary cards)
       - TimeRangePicker, SummaryStatsCards, VolumeBarChart, VolumeLegend, MuscleHeatMap, ExerciseProgressChart, PRListCard
       - FeatureErrorBoundary (wrap each section)

    5. Update SummaryStatsCards.tsx:
       - Remove streak card -- show only Workouts, Volume, PRs (3 cards)
       - Change grid from `grid-cols-2` to `grid-cols-3`
       - Update loading skeleton to show 3 placeholder cards instead of 4
       - Keep the same card styling (bg-bg-secondary, border, rounded-xl)

    6. Update useSummaryStats.ts:
       - Remove the entire streak calculation logic (the streakSQL query and JS loop)
       - Remove `streakWeeks` from the returned data object
       - Keep totalWorkouts, totalVolumeKg, totalPrs

    7. Update SummaryStats type in analytics.ts:
       - Remove `streakWeeks` field from the interface

    The page should feel cleaner with fewer sections. Each CollapsibleSection gets a title prop matching the section name.
  </action>
  <verify>
    Run `npm run build` -- should complete with no errors.
    Run `npm run dev` and visually confirm:
    - Analytics page loads without errors
    - Summary shows 3 cards in a row (no streak)
    - Exercise progress chart renders when exercise selected
    - Volume bar chart renders
    - Muscle heat map renders
    - Time range picker changes data
    - All sections are collapsible
    - No comparison, progression, or week comparison sections visible
  </verify>
  <done>
    Analytics page shows only: Summary Stats (3 cards), Exercise Progress, PRs, Volume, Heat Map. All in collapsible sections. No comparison/progression/week-comparison sections. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. Analytics page loads without console errors
4. Deleted files no longer exist on disk
5. No imports reference deleted modules
6. Exercise progress chart still shows data for selected exercise
7. Volume and heat map still render
8. Time range picker still works
9. Summary stats show 3 cards (Workouts, Volume, PRs)
</verification>

<success_criteria>
- Zero references to ComparisonSection, ProgressionDashboard, WeekComparisonCard, useProgressionStatus, useComparisonStats, useWeeklyComparison in the codebase (except dbt SQL models, which are build-time only)
- Analytics page renders 5 sections: Summary Stats, Exercise Progress, PRs, Volume Overview, Training Balance
- All sections except Summary Stats use CollapsibleSection
- Summary stats show 3 cards in 3-column grid
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/23-analytics-simplification/23-01-SUMMARY.md`
</output>
