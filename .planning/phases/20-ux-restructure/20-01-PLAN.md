---
phase: 20-ux-restructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/CollapsibleSection.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Exercises section on Workouts tab is collapsed by default, expandable with a single tap"
    - "Gyms section on Workouts tab is collapsed by default, expandable with a single tap"
    - "Quick Start remains the most prominent element on Workouts tab without scrolling past collapsed sections"
    - "Collapsed sections show item count badge (e.g. Exercises (12))"
    - "Expand/collapse has smooth ~200ms slide animation with rotating chevron"
  artifacts:
    - path: "src/components/ui/CollapsibleSection.tsx"
      provides: "Shared animated collapsible section component"
      exports: ["CollapsibleSection"]
      min_lines: 40
    - path: "src/App.tsx"
      provides: "Workouts tab layout with CollapsibleSection wrappers"
      contains: "CollapsibleSection"
  key_links:
    - from: "src/App.tsx"
      to: "src/components/ui/CollapsibleSection.tsx"
      via: "import and render wrapping ExerciseList and GymList"
      pattern: "CollapsibleSection.*title.*Exercises"
    - from: "src/components/ui/CollapsibleSection.tsx"
      to: "framer-motion"
      via: "m.div animate height auto"
      pattern: "animate.*height.*auto"
---

<objective>
Create a shared CollapsibleSection component using framer-motion and restructure the Workouts tab to wrap Exercises and Gyms in collapsible sections (collapsed by default) with Quick Start prominent at top.

Purpose: Reduce visual clutter on Workouts tab -- users see Quick Start immediately without scrolling past exercise/gym lists they rarely interact with during a session.
Output: CollapsibleSection.tsx component + restructured Workouts tab layout in App.tsx.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-ux-restructure/20-CONTEXT.md
@.planning/phases/20-ux-restructure/20-RESEARCH.md
@src/App.tsx
@src/components/ExerciseList.tsx
@src/components/GymList.tsx
@src/components/ui/Card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CollapsibleSection component and restructure Workouts tab</name>
  <files>
    src/components/ui/CollapsibleSection.tsx
    src/App.tsx
  </files>
  <action>
**1. Create `src/components/ui/CollapsibleSection.tsx`:**

Build a reusable collapsible section component with these specs:
- Props: `title: string`, `count?: number`, `defaultOpen?: boolean` (defaults false), `children: ReactNode`
- Uses `useState(defaultOpen)` for open/closed state (NO persistence -- per CONTEXT.md)
- Multiple sections can be open simultaneously (NOT accordion)
- Tappable header: `<button>` with `aria-expanded={isOpen}`, card-style background using `bg-bg-secondary hover:bg-bg-tertiary rounded-2xl`, full width flex layout
- Left side: title (text-base font-semibold text-text-primary) + count as parenthetical in muted text `(N)` if count provided
- Right side: animated chevron
- Chevron: Unicode right-pointing triangle `&#9654;` (or literal character), animated with `m.span animate={{ rotate: isOpen ? 90 : 0 }}`
- Content: `AnimatePresence initial={false}` wrapping `m.div` with `initial={{ height: 0, opacity: 0 }}`, `animate={{ height: 'auto', opacity: 1 }}`, `exit={{ height: 0, opacity: 0 }}`, transition duration 0.2s easeInOut, `style={{ overflow: 'hidden' }}`
- Inner content wrapped in `<div className="pt-3">` for spacing
- Respect `prefers-reduced-motion`: check `window.matchMedia('(prefers-reduced-motion: reduce)').matches` and set duration to 0 if true
- Import `m` and `AnimatePresence` from `framer-motion` (already available via LazyMotion in App.tsx)

**2. Modify `src/App.tsx` `renderWorkoutsContent()` (no-active-workout branch, around line 134):**

ExerciseList and GymList are wrapped as-is inside CollapsibleSection -- no modifications to those components. Their internal headers ("Library" / "Exercises" with "+ Add", and "Locations" / "Your Gyms" with "+ Add") become visible when the section is expanded.

Replace the current flat layout:
```tsx
<div className="space-y-8">
  <StartWorkout ... />
  <GymList ... />
  <ExerciseList ... />
</div>
```

With collapsible layout:
```tsx
<div className="space-y-4">
  {/* Quick Start - always prominent at top */}
  <StartWorkout plans={plans} gyms={gyms} onStarted={...} />

  {/* Collapsible sections */}
  <div className="space-y-3 pt-2">
    <CollapsibleSection title="Exercises" count={exercises.length}>
      <ExerciseList
        exercises={exercises}
        isLoading={exercisesLoading}
        onCreateExercise={handleCreateExercise}
        onUpdateExercise={handleUpdateExercise}
        onDeleteExercise={handleDeleteExercise}
      />
    </CollapsibleSection>

    <CollapsibleSection title="Gyms" count={gyms.length}>
      <GymList
        gyms={gyms}
        isLoading={gymsLoading}
        onCreateGym={handleCreateGym}
        onUpdateGym={handleUpdateGym}
        onDeleteGym={handleDeleteGym}
      />
    </CollapsibleSection>
  </div>
</div>
```

Add the import for CollapsibleSection at top of App.tsx.

**Overflow concern:** ExerciseForm and GymForm render inline within the sections. When collapsed, `overflow: hidden` on the m.div could clip forms that are currently open when user collapses. This is acceptable -- if user collapses a section, any open form naturally hides. When they re-expand, the form state is preserved (React state persists). If forms extend beyond the section during animation, add `onAnimationComplete` callback to set overflow to 'visible' after expand animation finishes, and set back to 'hidden' before collapse starts.
  </action>
  <verify>
1. `npm run build` completes without errors
2. `npm run lint` passes (or only pre-existing warnings)
3. `npm test` passes (unit tests)
4. Manual dev server check: Workouts tab shows Quick Start at top, Exercises and Gyms sections collapsed with count badges, tapping expands with smooth animation, chevron rotates
  </verify>
  <done>
- CollapsibleSection.tsx exists with framer-motion animation, chevron rotation, count badge, aria-expanded
- Workouts tab: Quick Start prominent at top, Exercises and Gyms collapsed by default
- Expanding a section reveals the full ExerciseList/GymList with their internal headers and "+ Add" buttons
- Multiple sections can be open simultaneously
- Smooth ~200ms slide animation (0 duration when prefers-reduced-motion)
- Build passes, unit tests pass
  </done>
</task>

</tasks>

<verification>
1. `npm run build` -- no TypeScript or build errors
2. `npm test` -- all unit tests pass
3. Dev server: Workouts tab shows collapsed Exercises and Gyms sections below Quick Start
4. Tapping section header expands with smooth animation
5. Chevron rotates from right-pointing to down-pointing
6. Count badge shows correct number (e.g., "Exercises (5)")
7. Multiple sections can be open at the same time
</verification>

<success_criteria>
- CollapsibleSection component created and functional
- Workouts tab restructured with collapsed Exercises and Gyms
- Quick Start is first/most prominent element (no scrolling needed)
- Animations smooth and respecting reduced-motion preference
- Build and unit tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/20-ux-restructure/20-01-SUMMARY.md`
</output>
