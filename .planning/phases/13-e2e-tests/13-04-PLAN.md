---
phase: 13-e2e-tests
plan: 04
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - src/e2e/workout-rotation.spec.ts
autonomous: true

must_haves:
  truths:
    - "E2E test sets up a workout rotation, starts a workout via Quick Start, completes it, and verifies the rotation advances to the next template"
  artifacts:
    - path: "src/e2e/workout-rotation.spec.ts"
      provides: "TEST-03: Quick Start and workout rotation advancement"
      min_lines: 80
  key_links:
    - from: "src/e2e/workout-rotation.spec.ts"
      to: "src/e2e/fixtures/app.fixture.ts"
      via: "import custom fixture"
      pattern: "import.*app\\.fixture"
---

<objective>
Write the Quick Start + Rotation Advancement E2E test (TEST-03 / SUCCESS CRITERION 3).

Purpose: Validates the workout rotation feature end-to-end -- setting up a rotation in Settings, using Quick Start to begin, and verifying rotation position advances after completion.

Output: src/e2e/workout-rotation.spec.ts with the full rotation workflow.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/13-e2e-tests/13-RESEARCH.md
@src/components/rotation/QuickStartCard.tsx
@src/components/settings/RotationSection.tsx
@src/components/workout/WorkoutComplete.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write workout-rotation.spec.ts -- Quick Start and rotation advancement</name>
  <files>src/e2e/workout-rotation.spec.ts</files>
  <action>
    Create `src/e2e/workout-rotation.spec.ts` using the custom fixture.

    Import `test`, `expect` from fixtures/app.fixture. Import `SEL`, `setRow` from helpers/selectors. Import `createGym`, `createExercise`, `logSet` from helpers/seed.

    Use `test.describe.serial()` since rotation advancement test depends on setup.

    **Setup (first test or beforeAll):**
    1. Create gym: "Rotation Gym", "Downtown"
    2. Create exercise A: "Rotation OHP" (Shoulders)
    3. Create exercise B: "Rotation Row" (Back)

    **Test 1: "Set up rotation with two templates and Quick Start appears"**
    1. Navigate to Templates tab
    2. Create template "Rotation Upper": add "Rotation OHP" exercise
    3. Create template "Rotation Lower": add "Rotation Row" exercise
    4. Navigate to Settings tab
    5. In the Workout Rotations section:
       - Fill rotation name input (use `input[placeholder*="Rotation name"]`) with "Test PPL"
       - Check both template checkboxes ("Rotation Upper" and "Rotation Lower")
       - Click "Create Rotation" button
    6. Click "Set Active" button on the created rotation
    7. Select default gym: choose "Rotation Gym" from the default gym dropdown (`#default-gym`)
    8. Navigate to Workouts tab
    9. Assert `SEL.quickStartCard` is visible
    10. Assert `SEL.rotationInfo` contains text "Workout 1 of 2" (position 0 + 1 = "1 of 2")
    11. Assert the template name "Rotation Upper" is visible within the quick start card

    **Test 2: "Quick Start workout and rotation advances to next template"**
    1. On the Workouts tab, click `SEL.btnQuickStart` inside the quick start card
    2. Wait for workout to start (set row appears or exercise name visible)
    3. Log a set: `logSet(page, 1, '40', '8', '2')`
    4. Click `SEL.btnFinishWorkout`
    5. Assert `SEL.workoutCompleteHeading` visible
    6. Click `SEL.btnSaveWorkout`
    7. Assert `SEL.workoutSavedHeading` visible ("Workout Saved!")
    8. Click `SEL.btnDoneWorkout`
    9. Wait for the Workouts tab to show the QuickStartCard again
    10. Assert `SEL.rotationInfo` now contains "Workout 2 of 2" (position advanced from 0 to 1)
    11. Assert template name changed to "Rotation Lower" in the quick start card

    **Test 3: "Rotation wraps around after completing all templates"**
    1. Click `SEL.btnQuickStart` (now starting "Rotation Lower")
    2. Log a set: `logSet(page, 1, '60', '10')`
    3. Finish and save the workout (same flow as Test 2)
    4. After Done, check QuickStartCard
    5. Assert `SEL.rotationInfo` contains "Workout 1 of 2" (wrapped back to position 0)
    6. Assert template name is "Rotation Upper" again

    **Implementation notes:**
    - The RotationSection UI creates rotations via Zustand (localStorage-backed). No DuckDB involved for rotation state itself.
    - The QuickStartCard reads from `useRotationStore` and `selectNextTemplate`. After `advanceRotation()` is called in WorkoutComplete.handleSave, the position increments and wraps via modulo.
    - Template checkboxes in RotationSection are `<input type="checkbox">` next to `<span>` with template name. Select them by finding the label containing the template name.
    - Be careful: the "Start Workout" text appears in both the QuickStartCard and the manual start section. Use the `SEL.btnQuickStart` selector (data-testid) to target the right button.
  </action>
  <verify>
    Run `npx playwright test workout-rotation.spec.ts --reporter=line` -- all 3 tests pass.
    Rotation wraps correctly from position 2/2 back to 1/2.
  </verify>
  <done>workout-rotation.spec.ts passes: sets up rotation, Quick Start works, rotation advances after completion, wraps around after all templates used.</done>
</task>

</tasks>

<verification>
- `npx playwright test workout-rotation.spec.ts` passes (3 tests)
- Quick Start card shows correct template and position
- Rotation advances after each completed workout
- Rotation wraps around after final template
</verification>

<success_criteria>
- TEST-03 fully covered: Quick Start + rotation advancement
- Rotation position correctly advances and wraps
- All assertions use data-testid selectors
</success_criteria>

<output>
After completion, create `.planning/phases/13-e2e-tests/13-04-SUMMARY.md`
</output>
