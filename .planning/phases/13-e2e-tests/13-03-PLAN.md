---
phase: 13-e2e-tests
plan: 03
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - src/e2e/batch-logging.spec.ts
autonomous: true

must_haves:
  truths:
    - "E2E test opens batch logging, verifies empty sets disable Save Workout, handles large weight/rep values, and confirms ghost text appears from a previous session"
  artifacts:
    - path: "src/e2e/batch-logging.spec.ts"
      provides: "TEST-02: Batch logging edge cases"
      min_lines: 100
  key_links:
    - from: "src/e2e/batch-logging.spec.ts"
      to: "src/e2e/fixtures/app.fixture.ts"
      via: "import custom fixture"
      pattern: "import.*app\\.fixture"
---

<objective>
Write the Batch Logging Edge Cases E2E test (TEST-02 / SUCCESS CRITERION 2).

Purpose: Validates batch logging handles edge cases correctly -- empty sets cannot be saved, large values are accepted, and ghost text from previous sessions appears as placeholders.

Output: src/e2e/batch-logging.spec.ts with multiple test cases.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/13-e2e-tests/13-RESEARCH.md
@src/components/workout/SetRow.tsx
@src/components/workout/SetGrid.tsx
@src/components/workout/WorkoutComplete.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write batch-logging.spec.ts -- Batch logging edge cases</name>
  <files>src/e2e/batch-logging.spec.ts</files>
  <action>
    Create `src/e2e/batch-logging.spec.ts` using the custom fixture.

    Import `test`, `expect` from fixtures/app.fixture. Import `SEL`, `setRow` from helpers/selectors. Import `createGym`, `createExercise`, `logSet` from helpers/seed.

    **Shared setup (test.beforeEach or test.describe setup):**
    All tests in this file need a gym, exercise, and template. Either:
    - Use `test.describe.serial()` and create them once in the first test
    - Or use `beforeAll` to set up via seed helpers

    Create: gym "Batch Gym", exercise "Batch Squat" (Legs), template "Batch Template" with that exercise.

    **Test 1: "Empty sets disable Save Workout button"**
    1. Start a workout (select gym + template, click Start)
    2. Wait for SetGrid to render (set row 1 should appear)
    3. Do NOT fill in any set data (leave weight/reps empty)
    4. Click `SEL.btnFinishWorkout`
    5. Assert `SEL.workoutCompleteHeading` is visible ("Workout Complete")
    6. Assert `SEL.btnSaveWorkout` is disabled (use `toBeDisabled()`)
    7. Assert `SEL.noSetsWarning` is visible ("Log at least one set to save this workout")

    **Test 2: "Max values accepted without error"**
    1. Start a fresh workout (may need to go back or clean up previous)
    2. Log set 1 with large values: weight "500", reps "100"
    3. Click `SEL.btnFinishWorkout`
    4. Assert `SEL.btnSaveWorkout` is enabled (NOT disabled -- large values should be accepted)
    5. Click `SEL.btnSaveWorkout`
    6. Assert `SEL.workoutSavedHeading` is visible
    7. Click `SEL.btnDoneWorkout`

    **Test 3: "Ghost text appears from previous session"**
    1. After Test 2 saved a workout with weight=500, reps=100, start a NEW workout with the same gym + template
    2. Wait for ghost data to load (wait for `SEL.loadingGhostData` to disappear, or wait for set row placeholders)
    3. Assert that set row 1's weight input has a `placeholder` attribute containing "500" (the ghost value from last session)
    4. Assert that set row 1's reps input has a `placeholder` attribute containing "100"
    5. Assert `SEL.firstTimeHint` is NOT visible (since we have prior data now)

    **Test 4: "Add Set button adds rows beyond template sets"**
    1. In an active workout, count the initial number of set rows
    2. Click `SEL.btnAddSet`
    3. Assert a new set row appears (set row count increased by 1)
    4. The new row should have empty inputs (no ghost data for extra sets)

    **Important implementation notes:**
    - For Test 3, ghost text appears as `placeholder` attributes on the Input elements. Use `page.locator(setRow(1).weight).getAttribute('placeholder')` to read placeholder values.
    - Since the Input component in this app is a custom component, the `data-testid` might be on a wrapper. Make sure to target the actual `<input>` element for placeholder reads: `page.locator(`${setRow(1).weight} input`)` or check if data-testid is directly on the input.
    - Use `test.describe.serial()` so tests run in order (Test 3 depends on Test 2 having saved data).
    - Between tests that need clean workout state, click "Go Back" from WorkoutComplete if still on that screen, or handle the active workout indicator.
  </action>
  <verify>
    Run `npx playwright test batch-logging.spec.ts --reporter=line` -- all tests pass.
    Ghost text test confirms placeholder values match the previously saved workout data.
  </verify>
  <done>batch-logging.spec.ts passes with 4 tests: empty sets disable save, max values accepted, ghost text appears from previous session, Add Set adds rows.</done>
</task>

</tasks>

<verification>
- `npx playwright test batch-logging.spec.ts` passes (all 4 tests)
- Empty sets test confirms Save button is disabled
- Ghost text test confirms placeholder values from last session
</verification>

<success_criteria>
- TEST-02 fully covered: batch logging edge cases (empty sets, max values, ghost text)
- Tests run serially since ghost text depends on prior workout data
- All assertions use data-testid selectors
</success_criteria>

<output>
After completion, create `.planning/phases/13-e2e-tests/13-03-SUMMARY.md`
</output>
