---
phase: 02-templates-logging
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/types/events.ts
  - src/types/template.ts
  - src/types/workout-session.ts
autonomous: true

must_haves:
  truths:
    - "Template and workout event types compile without errors"
    - "New dependencies installed and importable"
  artifacts:
    - path: "src/types/template.ts"
      provides: "Template domain types"
      exports: ["Template", "TemplateExercise"]
    - path: "src/types/workout-session.ts"
      provides: "Active workout session types"
      exports: ["WorkoutSession", "LoggedSet"]
    - path: "src/types/events.ts"
      provides: "Template and workout events"
      contains: "TemplateCreatedEvent"
  key_links:
    - from: "src/types/events.ts"
      to: "src/types/template.ts"
      via: "imports Template types"
      pattern: "import.*from.*template"
---

<objective>
Install Phase 2 dependencies and create type definitions for templates and workout sessions.

Purpose: Establish the type foundation and libraries needed for template management and workout logging. All subsequent plans depend on these types being correct.

Output: Installed dependencies (react-hook-form, zod, @dnd-kit/*, zustand, react-swipeable), template types, workout session types, and extended event types.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-templates-logging/02-RESEARCH.md
@.planning/phases/02-templates-logging/02-CONTEXT.md
@src/types/events.ts
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Phase 2 dependencies</name>
  <files>package.json</files>
  <action>
Install the libraries identified in RESEARCH.md:

```bash
npm install react-hook-form zod @hookform/resolvers @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities zustand react-swipeable
```

These provide:
- react-hook-form + zod + @hookform/resolvers: Form state and validation for template builder
- @dnd-kit/*: Drag-and-drop for exercise reordering
- zustand: Active workout session state with persist middleware
- react-swipeable: Swipe navigation between exercises

Do NOT install react-timer-hook (we'll use a custom hook for timer - simpler).
  </action>
  <verify>Run `npm ls react-hook-form zod zustand @dnd-kit/core` - all packages should be listed without errors</verify>
  <done>All 8 packages installed and listed in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create template and workout session types</name>
  <files>src/types/template.ts, src/types/workout-session.ts</files>
  <action>
Create `src/types/template.ts` with:
```typescript
// Template exercise in a workout template
export interface TemplateExercise {
  exercise_id: string;           // References dim_exercise
  order_index: number;           // Position in template (0-based)
  target_reps_min: number;       // e.g., 8
  target_reps_max: number;       // e.g., 12
  suggested_sets: number;        // Default number of sets (e.g., 3)
  rest_seconds: number | null;   // Override global rest time, null = use global default
  replacement_exercise_id: string | null;  // Optional predefined replacement
}

// Workout template (e.g., "Upper A", "Push Day")
export interface Template {
  template_id: string;
  name: string;
  exercises: TemplateExercise[];
  is_archived: boolean;          // Hidden but not deleted
}
```

Create `src/types/workout-session.ts` with:
```typescript
// A single logged set during active workout
export interface LoggedSet {
  set_id: string;                // Unique ID for this set
  exercise_id: string;           // Which exercise (may be substituted)
  original_exercise_id: string;  // Template's exercise (before substitution)
  weight_kg: number;
  reps: number;
  rir: number | null;            // Reps in reserve (optional)
  logged_at: string;             // ISO timestamp
}

// Active workout session state
export interface WorkoutSession {
  workout_id: string;
  template_id: string;
  gym_id: string;
  started_at: string;            // ISO timestamp
  current_exercise_index: number;
  sets: LoggedSet[];
  // Map of original_exercise_id -> substituted_exercise_id
  exerciseSubstitutions: Record<string, string>;
  // One-off custom exercises added during workout (name only, not saved to library)
  customExercises: Record<string, string>;  // exercise_id -> name
}
```
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors in new files</verify>
  <done>Template and WorkoutSession types defined and compile without errors</done>
</task>

<task type="auto">
  <name>Task 3: Extend events.ts with template and workout events</name>
  <files>src/types/events.ts</files>
  <action>
Add template and workout event types to `src/types/events.ts`:

```typescript
import type { TemplateExercise } from './template';

// Template events (TMPL-01 through TMPL-07)
export interface TemplateCreatedEvent extends BaseEvent {
  event_type: 'template_created';
  template_id: string;
  name: string;
  exercises: TemplateExercise[];
}

export interface TemplateUpdatedEvent extends BaseEvent {
  event_type: 'template_updated';
  template_id: string;
  name: string;
  exercises: TemplateExercise[];
}

export interface TemplateDeletedEvent extends BaseEvent {
  event_type: 'template_deleted';
  template_id: string;
}

export interface TemplateArchivedEvent extends BaseEvent {
  event_type: 'template_archived';
  template_id: string;
  is_archived: boolean;  // true = archive, false = restore
}

// Workout events (LOG-01 through LOG-09)
export interface WorkoutStartedEvent extends BaseEvent {
  event_type: 'workout_started';
  workout_id: string;
  template_id: string;
  gym_id: string;
  started_at: string;
}

export interface SetLoggedEvent extends BaseEvent {
  event_type: 'set_logged';
  workout_id: string;
  set_id: string;
  exercise_id: string;           // Actual exercise used (may be substitution)
  original_exercise_id: string;  // Template's exercise
  weight_kg: number;
  reps: number;
  rir: number | null;
}

export interface WorkoutCompletedEvent extends BaseEvent {
  event_type: 'workout_completed';
  workout_id: string;
  completed_at: string;
}

export interface WorkoutCancelledEvent extends BaseEvent {
  event_type: 'workout_cancelled';
  workout_id: string;
  cancelled_at: string;
}
```

Update the `GymLogEvent` union type to include all new event types:
```typescript
export type GymLogEvent =
  | ExerciseCreatedEvent
  | ExerciseUpdatedEvent
  | ExerciseDeletedEvent
  | GymCreatedEvent
  | GymUpdatedEvent
  | GymDeletedEvent
  | TemplateCreatedEvent
  | TemplateUpdatedEvent
  | TemplateDeletedEvent
  | TemplateArchivedEvent
  | WorkoutStartedEvent
  | SetLoggedEvent
  | WorkoutCompletedEvent
  | WorkoutCancelledEvent;
```
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors. Import TemplateCreatedEvent in a test file to verify export.</verify>
  <done>All template and workout events defined and included in GymLogEvent union</done>
</task>

</tasks>

<verification>
1. `npm ls react-hook-form zod zustand @dnd-kit/core @dnd-kit/sortable` shows all packages
2. `npx tsc --noEmit` passes with no errors
3. Types are importable: `import { Template } from './types/template'` works
</verification>

<success_criteria>
- All 8 dependencies installed
- Template and TemplateExercise types defined
- WorkoutSession and LoggedSet types defined
- 8 new event types added to events.ts
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-templates-logging/02-01-SUMMARY.md`
</output>
