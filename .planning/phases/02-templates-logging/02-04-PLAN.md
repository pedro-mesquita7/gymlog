---
phase: 02-templates-logging
plan: 04
type: execute
wave: 3
depends_on: ["02-01", "02-02", "02-03"]
files_modified:
  - src/components/templates/TemplateList.tsx
  - src/components/templates/TemplateCard.tsx
  - src/components/Navigation.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can view list of templates"
    - "User can create, edit, delete templates"
    - "User can archive and restore templates"
    - "User can duplicate existing template"
    - "User can navigate between Workouts and Templates tabs"
  artifacts:
    - path: "src/components/templates/TemplateList.tsx"
      provides: "Template list with CRUD UI"
      min_lines: 50
    - path: "src/components/templates/TemplateCard.tsx"
      provides: "Individual template display"
      contains: "archiveTemplate"
    - path: "src/components/Navigation.tsx"
      provides: "Bottom navigation tabs"
      contains: "Templates"
  key_links:
    - from: "src/components/templates/TemplateList.tsx"
      to: "src/hooks/useTemplates.ts"
      via: "useTemplates hook"
      pattern: "useTemplates"
    - from: "src/components/templates/TemplateList.tsx"
      to: "src/components/templates/TemplateBuilder.tsx"
      via: "imports and renders TemplateBuilder for create/edit"
      pattern: "import.*TemplateBuilder.*from.*TemplateBuilder"
    - from: "src/App.tsx"
      to: "src/components/Navigation.tsx"
      via: "tab-based routing"
      pattern: "activeTab"
---

<objective>
Create the Template List UI with CRUD operations and add bottom navigation for switching between Workouts and Templates.

Purpose: Enable users to manage their workout templates - view, create, edit, delete, archive, and duplicate. Navigation allows moving between main app sections.

Output: TemplateList and TemplateCard components, Navigation component, updated App.tsx with tab routing.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-templates-logging/02-CONTEXT.md
@src/hooks/useTemplates.ts
@src/components/templates/TemplateBuilder.tsx
@src/components/GymList.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TemplateCard component</name>
  <files>src/components/templates/TemplateCard.tsx</files>
  <action>
Create `src/components/templates/TemplateCard.tsx` - displays a single template with actions.

Shows:
- Template name
- Exercise count
- First few exercise names (preview)
- Action menu: Edit, Duplicate, Archive/Restore, Delete

```typescript
import { useState } from 'react';
import type { Template } from '../../types/template';
import type { Exercise } from '../../types/database';
import { DeleteConfirmation } from '../DeleteConfirmation';

interface TemplateCardProps {
  template: Template;
  exercises: Exercise[];  // For name lookup
  onEdit: () => void;
  onDuplicate: () => void;
  onArchive: (archive: boolean) => void;
  onDelete: () => void;
}

export function TemplateCard({ template, exercises, onEdit, onDuplicate, onArchive, onDelete }: TemplateCardProps) {
  const [showMenu, setShowMenu] = useState(false);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);

  const getExerciseName = (exerciseId: string) =>
    exercises.find(e => e.exercise_id === exerciseId)?.name ?? 'Unknown';

  // Preview first 3 exercises
  const exercisePreview = template.exercises
    .slice(0, 3)
    .map(e => getExerciseName(e.exercise_id));
  const moreCount = Math.max(0, template.exercises.length - 3);

  return (
    <div className={`bg-zinc-800/50 rounded-lg p-4 ${template.is_archived ? 'opacity-60' : ''}`}>
      <div className="flex items-start justify-between">
        <div className="flex-1 cursor-pointer" onClick={onEdit}>
          <h3 className="font-medium flex items-center gap-2">
            {template.name}
            {template.is_archived && (
              <span className="text-xs bg-zinc-700 px-2 py-0.5 rounded">Archived</span>
            )}
          </h3>
          <p className="text-sm text-zinc-500 mt-1">
            {template.exercises.length} exercise{template.exercises.length !== 1 ? 's' : ''}
          </p>
          {exercisePreview.length > 0 && (
            <p className="text-xs text-zinc-600 mt-2">
              {exercisePreview.join(', ')}
              {moreCount > 0 && ` +${moreCount} more`}
            </p>
          )}
        </div>

        {/* Actions menu */}
        <div className="relative">
          <button
            onClick={() => setShowMenu(!showMenu)}
            className="p-2 text-zinc-500 hover:text-zinc-300"
          >
            <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
            </svg>
          </button>

          {showMenu && (
            <>
              {/* Backdrop */}
              <div
                className="fixed inset-0 z-10"
                onClick={() => setShowMenu(false)}
              />

              {/* Menu */}
              <div className="absolute right-0 mt-1 w-40 bg-zinc-700 rounded-lg shadow-lg z-20 py-1">
                <button
                  onClick={() => { setShowMenu(false); onEdit(); }}
                  className="w-full px-4 py-2 text-left text-sm hover:bg-zinc-600"
                >
                  Edit
                </button>
                <button
                  onClick={() => { setShowMenu(false); onDuplicate(); }}
                  className="w-full px-4 py-2 text-left text-sm hover:bg-zinc-600"
                >
                  Duplicate
                </button>
                <button
                  onClick={() => { setShowMenu(false); onArchive(!template.is_archived); }}
                  className="w-full px-4 py-2 text-left text-sm hover:bg-zinc-600"
                >
                  {template.is_archived ? 'Restore' : 'Archive'}
                </button>
                <button
                  onClick={() => { setShowMenu(false); setShowDeleteConfirm(true); }}
                  className="w-full px-4 py-2 text-left text-sm text-red-400 hover:bg-zinc-600"
                >
                  Delete
                </button>
              </div>
            </>
          )}
        </div>
      </div>

      {/* Delete confirmation - uses existing DeleteConfirmation with isOpen prop */}
      <DeleteConfirmation
        isOpen={showDeleteConfirm}
        title="Delete Template"
        message={`Are you sure you want to delete "${template.name}"? This cannot be undone.`}
        onConfirm={() => { setShowDeleteConfirm(false); onDelete(); }}
        onCancel={() => setShowDeleteConfirm(false)}
      />
    </div>
  );
}
```
  </action>
  <verify>Component imports without errors. Shows template info and action menu.</verify>
  <done>TemplateCard displays template with edit, duplicate, archive, delete actions</done>
</task>

<task type="auto">
  <name>Task 2: Create TemplateList and Navigation components</name>
  <files>src/components/templates/TemplateList.tsx, src/components/Navigation.tsx</files>
  <action>
Create `src/components/templates/TemplateList.tsx`.

**CRITICAL**: This component imports and renders TemplateBuilder from 02-03. Verify the import works:
```typescript
import { TemplateBuilder } from './TemplateBuilder';
import type { TemplateFormData } from './TemplateBuilder';
```

Full component:

```typescript
import { useState } from 'react';
import { useTemplates } from '../../hooks/useTemplates';
import { useExercises } from '../../hooks/useExercises';
import { TemplateCard } from './TemplateCard';
import { TemplateBuilder } from './TemplateBuilder';
import type { TemplateFormData } from './TemplateBuilder';

export function TemplateList() {
  const { templates, activeTemplates, createTemplate, updateTemplate, deleteTemplate, archiveTemplate, duplicateTemplate, isLoading } = useTemplates();
  const { exercises } = useExercises();

  const [view, setView] = useState<'list' | 'create' | 'edit'>('list');
  const [editingTemplateId, setEditingTemplateId] = useState<string | null>(null);
  const [showArchived, setShowArchived] = useState(false);

  const displayTemplates = showArchived ? templates : activeTemplates;
  const editingTemplate = editingTemplateId
    ? templates.find(t => t.template_id === editingTemplateId)
    : undefined;

  const handleCreate = async (data: TemplateFormData) => {
    await createTemplate({
      name: data.name,
      exercises: data.exercises.map((e, i) => ({
        ...e,
        order_index: i,
        rest_seconds: e.rest_seconds ?? null,
        replacement_exercise_id: e.replacement_exercise_id ?? null,
      })),
    });
    setView('list');
  };

  const handleUpdate = async (data: TemplateFormData) => {
    if (!editingTemplateId) return;
    await updateTemplate(editingTemplateId, {
      name: data.name,
      exercises: data.exercises.map((e, i) => ({
        ...e,
        order_index: i,
        rest_seconds: e.rest_seconds ?? null,
        replacement_exercise_id: e.replacement_exercise_id ?? null,
      })),
    });
    setView('list');
    setEditingTemplateId(null);
  };

  const handleDuplicate = async (templateId: string) => {
    const template = templates.find(t => t.template_id === templateId);
    if (!template) return;
    await duplicateTemplate(templateId, `${template.name} (Copy)`);
  };

  // Create/Edit form view - renders TemplateBuilder component
  if (view === 'create' || view === 'edit') {
    return (
      <div>
        <h2 className="text-lg font-semibold mb-6">
          {view === 'create' ? 'Create Template' : 'Edit Template'}
        </h2>
        <TemplateBuilder
          exercises={exercises}
          template={editingTemplate}
          onSubmit={view === 'create' ? handleCreate : handleUpdate}
          onCancel={() => { setView('list'); setEditingTemplateId(null); }}
        />
      </div>
    );
  }

  // List view
  return (
    <div>
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-lg font-semibold">Templates</h2>
        <div className="flex items-center gap-3">
          <label className="flex items-center gap-2 text-sm text-zinc-500">
            <input
              type="checkbox"
              checked={showArchived}
              onChange={(e) => setShowArchived(e.target.checked)}
              className="rounded border-zinc-600"
            />
            Show archived
          </label>
          <button
            onClick={() => setView('create')}
            className="px-4 py-2 bg-accent hover:bg-accent/90 text-black text-sm font-medium rounded-lg transition-colors"
          >
            + New Template
          </button>
        </div>
      </div>

      {isLoading ? (
        <div className="text-center py-8 text-zinc-500">Loading templates...</div>
      ) : displayTemplates.length === 0 ? (
        <div className="text-center py-12">
          <p className="text-zinc-500 mb-4">
            {showArchived ? 'No templates yet' : 'No active templates'}
          </p>
          <button
            onClick={() => setView('create')}
            className="text-accent hover:text-accent/80"
          >
            Create your first template
          </button>
        </div>
      ) : (
        <div className="space-y-3">
          {displayTemplates.map(template => (
            <TemplateCard
              key={template.template_id}
              template={template}
              exercises={exercises}
              onEdit={() => { setEditingTemplateId(template.template_id); setView('edit'); }}
              onDuplicate={() => handleDuplicate(template.template_id)}
              onArchive={(archive) => archiveTemplate(template.template_id, archive)}
              onDelete={() => deleteTemplate(template.template_id)}
            />
          ))}
        </div>
      )}
    </div>
  );
}
```

Create `src/components/Navigation.tsx`:

```typescript
type Tab = 'workouts' | 'templates';

interface NavigationProps {
  activeTab: Tab;
  onTabChange: (tab: Tab) => void;
}

export function Navigation({ activeTab, onTabChange }: NavigationProps) {
  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-zinc-900 border-t border-zinc-800">
      <div className="max-w-2xl mx-auto flex">
        <button
          onClick={() => onTabChange('workouts')}
          className={`flex-1 py-4 text-center text-sm font-medium transition-colors ${
            activeTab === 'workouts'
              ? 'text-accent border-t-2 border-accent -mt-px'
              : 'text-zinc-500 hover:text-zinc-300'
          }`}
        >
          Workouts
        </button>
        <button
          onClick={() => onTabChange('templates')}
          className={`flex-1 py-4 text-center text-sm font-medium transition-colors ${
            activeTab === 'templates'
              ? 'text-accent border-t-2 border-accent -mt-px'
              : 'text-zinc-500 hover:text-zinc-300'
          }`}
        >
          Templates
        </button>
      </div>
    </nav>
  );
}

export type { Tab };
```
  </action>
  <verify>Components render correctly. TemplateList shows templates and switches to builder. Navigation shows tabs.</verify>
  <done>TemplateList provides full CRUD UI, Navigation provides tab switching</done>
</task>

<task type="auto">
  <name>Task 3: Update App.tsx with tab navigation</name>
  <files>src/App.tsx</files>
  <action>
Update `src/App.tsx` to include:
1. Tab state for switching between workouts and templates
2. Navigation component at bottom
3. Render appropriate content based on active tab
4. Padding at bottom for navigation bar

```typescript
import { useState } from 'react';
import { useDuckDB } from './hooks/useDuckDB';
import { useExercises } from './hooks/useExercises';
import { useGyms } from './hooks/useGyms';
import { ExerciseList } from './components/ExerciseList';
import { GymList } from './components/GymList';
import { TemplateList } from './components/templates/TemplateList';
import { Navigation, type Tab } from './components/Navigation';

function App() {
  const [activeTab, setActiveTab] = useState<Tab>('workouts');
  const { status, eventCount, refreshEventCount } = useDuckDB();

  // ... existing hooks (useExercises, useGyms)
  const {
    exercises,
    isLoading: exercisesLoading,
    createExercise,
    updateExercise,
    deleteExercise,
  } = useExercises();

  const {
    gyms,
    isLoading: gymsLoading,
    createGym,
    updateGym,
    deleteGym,
  } = useGyms();

  // ... existing handlers with refreshEventCount

  // Loading/error states remain same

  return (
    <div className="min-h-screen pb-20"> {/* pb-20 for bottom nav */}
      {/* Header - same as before */}
      <header className="border-b border-zinc-800">
        {/* ... existing header content */}
      </header>

      {/* Main Content - conditional on tab */}
      <main className="max-w-2xl mx-auto px-6 py-10">
        {activeTab === 'workouts' ? (
          <div className="space-y-12">
            <GymList
              gyms={gyms}
              isLoading={gymsLoading}
              onCreateGym={handleCreateGym}
              onUpdateGym={handleUpdateGym}
              onDeleteGym={handleDeleteGym}
            />
            <ExerciseList
              exercises={exercises}
              isLoading={exercisesLoading}
              onCreateExercise={handleCreateExercise}
              onUpdateExercise={handleUpdateExercise}
              onDeleteExercise={handleDeleteExercise}
            />
          </div>
        ) : (
          <TemplateList />
        )}
      </main>

      {/* Bottom Navigation */}
      <Navigation activeTab={activeTab} onTabChange={setActiveTab} />
    </div>
  );
}

export default App;
```

Key changes:
- Add activeTab state with useState
- Add pb-20 class to main container for bottom nav spacing
- Conditional rendering based on activeTab
- Import and render Navigation component
- Templates tab shows TemplateList
- Workouts tab shows existing GymList + ExerciseList (Phase 2 will add workout start here later)
  </action>
  <verify>App renders. Tab switching works. Templates tab shows TemplateList. Workouts tab shows gyms/exercises.</verify>
  <done>App.tsx integrates tab navigation with workouts and templates views</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Navigation shows at bottom of screen
3. Tab switching works between Workouts and Templates
4. Templates tab shows list (empty initially)
5. Can create template - it appears in list
6. Can edit, duplicate, archive, delete templates
</verification>

<success_criteria>
- TemplateCard shows template info with action menu
- TemplateList shows templates with create/edit flow
- Show archived toggle works
- Duplicate creates copy of template
- Archive/restore toggles archived state
- Delete removes template with confirmation
- Navigation shows two tabs at bottom
- Tab switching renders correct content
- App has padding for bottom nav
</success_criteria>

<output>
After completion, create `.planning/phases/02-templates-logging/02-04-SUMMARY.md`
</output>
