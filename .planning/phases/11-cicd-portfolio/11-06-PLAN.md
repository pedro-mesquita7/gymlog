---
phase: 11-cicd-portfolio
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main.tsx
  - src/index.css
  - src/styles/fonts.css
  - vite.config.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Fonts load correctly in production build (dist/assets contains woff2 files)"
    - "No large chunk warnings above 1000KB threshold"
    - "DuckDB-WASM is split into its own chunk"
  artifacts:
    - path: "src/main.tsx"
      provides: "Font imports via JS"
      contains: "@fontsource/geist-sans"
    - path: "vite.config.ts"
      provides: "Manual chunks and size limit config"
      contains: "manualChunks"
  key_links:
    - from: "src/main.tsx"
      to: "@fontsource packages"
      via: "JS import (not CSS @import)"
      pattern: "import.*@fontsource"
---

<objective>
Fix production build warnings: broken fonts, large chunks.

Purpose: Fonts are broken in production because CSS @import of @fontsource packages prevents Vite from bundling font files. DuckDB-WASM creates a 745KB chunk warning.
Output: Clean production build with working fonts and properly chunked bundles.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/11-cicd-portfolio/11-UAT.md
@src/main.tsx
@src/index.css
@src/styles/fonts.css
@vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move font imports from CSS to JS and configure Vite chunks</name>
  <files>src/main.tsx, src/index.css, src/styles/fonts.css, vite.config.ts</files>
  <action>
1. In `src/main.tsx`, add font imports BEFORE the `./index.css` import:
   ```
   import '@fontsource/geist-sans/400.css'
   import '@fontsource/geist-sans/500.css'
   import '@fontsource/geist-sans/600.css'
   import '@fontsource/geist-sans/700.css'
   import '@fontsource/geist-mono/400.css'
   import '@fontsource/geist-mono/500.css'
   import '@fontsource/geist-mono/600.css'
   ```

2. In `src/index.css`, remove the line `@import "./styles/fonts.css";` (line 2). Keep the `@import "tailwindcss";` line.

3. Delete `src/styles/fonts.css` entirely (or empty it with a comment explaining fonts are now imported via main.tsx).

4. In `vite.config.ts`, update the `build` section:
   ```ts
   build: {
     target: 'esnext',
     chunkSizeWarningLimit: 1000,
     rollupOptions: {
       output: {
         manualChunks: {
           'duckdb': ['@duckdb/duckdb-wasm'],
         },
       },
     },
   },
   ```
  </action>
  <verify>
Run `npx vite build 2>&1` and confirm:
- No "font" or "@fontsource" related warnings
- No chunk size warnings (or only DuckDB chunk which is under new 1000KB limit)
- `ls dist/assets/` shows .woff2 font files present

Run `npx vite build 2>&1 | grep -i "warning"` to check remaining warnings.
  </verify>
  <done>Production build completes with font files in dist/assets, no chunk size warnings above 1000KB, DuckDB isolated in its own chunk.</done>
</task>

</tasks>

<verification>
- `npx vite build` succeeds without font-related errors
- `find dist/assets -name "*.woff2" | head -5` returns font files
- No chunk warnings above 1000KB threshold
- Dev server still works: `npx vite --host 0.0.0.0 &` then fonts render correctly
</verification>

<success_criteria>
- Font files (woff2) are present in dist/assets after build
- DuckDB-WASM is in a separate chunk named duckdb-*.js
- Build output shows no warnings above the 1000KB limit
</success_criteria>

<output>
After completion, create `.planning/phases/11-cicd-portfolio/11-06-SUMMARY.md`
</output>
