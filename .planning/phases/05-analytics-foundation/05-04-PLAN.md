---
phase: 05-analytics-foundation
plan: 04
type: execute
wave: 2
depends_on: ["05-02"]
files_modified:
  - src/index.css
  - src/components/analytics/ChartContainer.tsx
  - src/components/analytics/ExerciseProgressChart.tsx
  - src/components/analytics/WeekComparisonCard.tsx
  - src/components/analytics/PRListCard.tsx
autonomous: true

must_haves:
  truths:
    - "CSS variables defined for chart colors (--chart-primary, --chart-success, --chart-muted)"
    - "ChartContainer provides fixed-height wrapper for ResponsiveContainer"
    - "ExerciseProgressChart shows weight + 1RM trend lines"
    - "WeekComparisonCard shows this week vs last week metrics"
    - "PRListCard surfaces existing PRList component in Analytics context"
  artifacts:
    - path: "src/index.css"
      provides: "Chart color CSS variables"
      contains: "--chart-primary"
    - path: "src/components/analytics/ChartContainer.tsx"
      provides: "ResponsiveContainer wrapper"
      contains: "ResponsiveContainer"
    - path: "src/components/analytics/ExerciseProgressChart.tsx"
      provides: "LineChart for weight/1RM progression"
      contains: "LineChart"
    - path: "src/components/analytics/WeekComparisonCard.tsx"
      provides: "Week-over-week comparison display"
      contains: "weightChangePct"
    - path: "src/components/analytics/PRListCard.tsx"
      provides: "PR list in card format"
      contains: "PRList"
  key_links:
    - from: "src/components/analytics/ExerciseProgressChart.tsx"
      to: "recharts"
      via: "LineChart import"
      pattern: "import.*LineChart.*from 'recharts'"
    - from: "src/components/analytics/ChartContainer.tsx"
      to: "recharts"
      via: "ResponsiveContainer import"
      pattern: "ResponsiveContainer"
---

<objective>
Create chart components using Recharts for exercise progress visualization.

Purpose: Builds the visual components for analytics - line charts for progress, comparison cards for week-over-week, and PR summary. These components will be lazy-loaded in Plan 05 to avoid bundle bloat.
Output: Reusable chart components ready for AnalyticsPage assembly.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-analytics-foundation/05-RESEARCH.md

# Existing components for pattern reference
@src/components/history/PRList.tsx
@src/index.css

# Types from Plan 02
@src/types/analytics.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add chart CSS variables and create ChartContainer</name>
  <files>
    src/index.css
    src/components/analytics/ChartContainer.tsx
  </files>
  <action>
**1. Update src/index.css** - Add chart color variables after existing --accent:

```css
@layer base {
  :root {
    --accent: 16 100% 50%; /* Vibrant orange */
    --chart-primary: 220 70% 50%;   /* Blue for primary data */
    --chart-success: 142 76% 36%;   /* Green for 1RM/positive */
    --chart-muted: 240 5% 65%;      /* Gray for axes/grid */
  }
  /* ... rest of existing styles */
}
```

**2. Create src/components/analytics/ChartContainer.tsx**:

```typescript
import { ResponsiveContainer } from 'recharts';
import type { ReactElement } from 'react';

interface ChartContainerProps {
  children: ReactElement;
  height?: number;
}

/**
 * Wrapper for Recharts charts that provides fixed-height container
 * Required because ResponsiveContainer needs pixel-based height parent
 */
export function ChartContainer({ children, height = 300 }: ChartContainerProps) {
  return (
    <div style={{ width: '100%', height }} className="relative">
      <ResponsiveContainer width="100%" height="100%">
        {children}
      </ResponsiveContainer>
    </div>
  );
}
```

Create the analytics directory: `mkdir -p src/components/analytics`
  </action>
  <verify>Run `npx tsc --noEmit` - should pass</verify>
  <done>CSS variables for chart colors exist, ChartContainer wraps ResponsiveContainer</done>
</task>

<task type="auto">
  <name>Task 2: Create ExerciseProgressChart component</name>
  <files>
    src/components/analytics/ExerciseProgressChart.tsx
  </files>
  <action>
Create src/components/analytics/ExerciseProgressChart.tsx:

```typescript
import { useMemo } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip } from 'recharts';
import { format } from 'date-fns';
import { ChartContainer } from './ChartContainer';
import type { ProgressPoint } from '../../types/analytics';

interface ExerciseProgressChartProps {
  data: ProgressPoint[];
  exerciseName: string;
  showVolume?: boolean;
}

/**
 * Line chart showing exercise progress over time (CHART-01, CHART-02, CHART-03)
 * Displays max weight (solid line) and estimated 1RM (dashed line)
 */
export function ExerciseProgressChart({
  data,
  exerciseName,
  showVolume = false
}: ExerciseProgressChartProps) {
  // Memoize chart data to prevent re-renders (Pitfall 2)
  const chartData = useMemo(() => data, [data]);

  if (chartData.length === 0) {
    return (
      <div className="text-center py-8 text-zinc-500">
        No data yet. Log workouts to see your {exerciseName} progress.
      </div>
    );
  }

  return (
    <div className="space-y-2">
      <h3 className="text-sm font-medium text-zinc-400">{exerciseName} Progress</h3>
      <ChartContainer height={250}>
        <LineChart data={chartData} margin={{ top: 5, right: 20, left: 0, bottom: 5 }}>
          <CartesianGrid
            strokeDasharray="3 3"
            stroke="hsl(var(--chart-muted) / 0.3)"
          />
          <XAxis
            dataKey="date"
            tickFormatter={(date) => format(new Date(date), 'MMM d')}
            stroke="hsl(var(--chart-muted))"
            fontSize={12}
            tickLine={false}
          />
          <YAxis
            stroke="hsl(var(--chart-muted))"
            fontSize={12}
            width={45}
            tickLine={false}
            axisLine={false}
          />
          <Tooltip
            contentStyle={{
              backgroundColor: 'hsl(240 6% 10%)',
              border: '1px solid hsl(240 4% 16%)',
              borderRadius: '8px',
            }}
            labelFormatter={(date) => format(new Date(date), 'PPP')}
            formatter={(value: number, name: string) => [
              `${value.toFixed(1)} kg`,
              name === 'maxWeight' ? 'Max Weight' :
              name === 'max1rm' ? 'Est. 1RM' : 'Volume'
            ]}
          />
          <Line
            type="monotone"
            dataKey="maxWeight"
            name="maxWeight"
            stroke="hsl(var(--accent))"
            strokeWidth={2}
            dot={{ r: 3, fill: 'hsl(var(--accent))' }}
            activeDot={{ r: 5 }}
          />
          <Line
            type="monotone"
            dataKey="max1rm"
            name="max1rm"
            stroke="hsl(var(--chart-success))"
            strokeWidth={2}
            strokeDasharray="5 5"
            dot={false}
          />
          {showVolume && (
            <>
              <YAxis
                yAxisId="volume"
                orientation="right"
                stroke="hsl(var(--chart-primary))"
                fontSize={12}
                tickLine={false}
                axisLine={false}
              />
              <Line
                type="monotone"
                dataKey="totalVolume"
                name="totalVolume"
                stroke="hsl(var(--chart-primary))"
                strokeWidth={1}
                dot={false}
                yAxisId="volume"
              />
            </>
          )}
        </LineChart>
      </ChartContainer>
      <div className="flex items-center justify-center gap-4 text-xs text-zinc-500">
        <span className="flex items-center gap-1">
          <span className="w-3 h-0.5 bg-accent rounded" />
          Max Weight
        </span>
        <span className="flex items-center gap-1">
          <span className="w-3 h-0.5 rounded" style={{ backgroundColor: 'hsl(var(--chart-success))' }} />
          Est. 1RM
        </span>
      </div>
    </div>
  );
}
```

Key requirements:
- Use CSS variables for colors (supports future dark mode)
- Memoize data to prevent unnecessary re-renders
- Show empty state when no data
- Include legend for line meanings
  </action>
  <verify>Run `npx tsc --noEmit` - should pass</verify>
  <done>ExerciseProgressChart renders weight + 1RM lines with proper styling</done>
</task>

<task type="auto">
  <name>Task 3: Create WeekComparisonCard and PRListCard components</name>
  <files>
    src/components/analytics/WeekComparisonCard.tsx
    src/components/analytics/PRListCard.tsx
  </files>
  <action>
**1. Create src/components/analytics/WeekComparisonCard.tsx**:

```typescript
import type { WeeklyComparison } from '../../types/analytics';

interface WeekComparisonCardProps {
  data: WeeklyComparison;
}

/**
 * Card showing this week vs last week performance (CHART-04)
 */
export function WeekComparisonCard({ data }: WeekComparisonCardProps) {
  const formatChange = (pct: number | null) => {
    if (pct === null) return 'N/A';
    const sign = pct >= 0 ? '+' : '';
    return `${sign}${pct.toFixed(1)}%`;
  };

  const getChangeColor = (pct: number | null) => {
    if (pct === null) return 'text-zinc-500';
    if (pct > 0) return 'text-green-400';
    if (pct < 0) return 'text-red-400';
    return 'text-zinc-400';
  };

  return (
    <div className="bg-zinc-800/50 rounded-lg p-4 space-y-3">
      <div className="flex items-center justify-between">
        <h4 className="font-medium text-zinc-200">{data.exerciseName}</h4>
        <span className="text-xs text-zinc-500">{data.muscleGroup}</span>
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div>
          <div className="text-xs text-zinc-500 mb-1">Max Weight</div>
          <div className="flex items-baseline gap-2">
            <span className="text-lg font-bold text-zinc-200">
              {data.maxWeight.toFixed(1)} kg
            </span>
            <span className={`text-sm ${getChangeColor(data.weightChangePct)}`}>
              {formatChange(data.weightChangePct)}
            </span>
          </div>
        </div>

        <div>
          <div className="text-xs text-zinc-500 mb-1">Volume</div>
          <div className="flex items-baseline gap-2">
            <span className="text-lg font-bold text-zinc-200">
              {data.totalVolume.toLocaleString()} kg
            </span>
            <span className={`text-sm ${getChangeColor(data.volumeChangePct)}`}>
              {formatChange(data.volumeChangePct)}
            </span>
          </div>
        </div>
      </div>

      <div className="text-xs text-zinc-500">
        {data.setCount} sets this week
        {data.prevMaxWeight !== null && (
          <span> (vs {data.prevMaxWeight.toFixed(1)} kg last week)</span>
        )}
      </div>
    </div>
  );
}
```

**2. Create src/components/analytics/PRListCard.tsx**:

```typescript
import { PRList } from '../history/PRList';

interface PRListCardProps {
  exerciseId: string;
  exerciseName: string;
}

/**
 * Card wrapper for PRList component in Analytics context (PR-01)
 */
export function PRListCard({ exerciseId, exerciseName }: PRListCardProps) {
  return (
    <div className="bg-zinc-800/50 rounded-lg p-4">
      <PRList exerciseId={exerciseId} exerciseName={exerciseName} />
    </div>
  );
}
```

Key requirements:
- WeekComparisonCard shows color-coded percentage changes
- PRListCard reuses existing PRList component
- Consistent card styling with existing components
  </action>
  <verify>Run `npx tsc --noEmit` - should pass</verify>
  <done>WeekComparisonCard and PRListCard exist with proper styling</done>
</task>

</tasks>

<verification>
- [ ] `npx tsc --noEmit` passes
- [ ] CSS has --chart-primary, --chart-success, --chart-muted variables
- [ ] ChartContainer uses ResponsiveContainer from recharts
- [ ] ExerciseProgressChart renders LineChart with weight and 1RM lines
- [ ] WeekComparisonCard shows percentage changes with colors
- [ ] PRListCard wraps existing PRList component
</verification>

<success_criteria>
- All chart components render without errors
- CSS variables enable consistent chart theming
- ChartContainer provides required fixed-height wrapper
- Components follow existing codebase styling patterns
- date-fns format() used for date display
</success_criteria>

<output>
After completion, create `.planning/phases/05-analytics-foundation/05-04-SUMMARY.md`
</output>
