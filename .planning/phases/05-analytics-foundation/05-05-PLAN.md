---
phase: 05-analytics-foundation
plan: 05
type: execute
wave: 3
depends_on: ["05-03", "05-04"]
files_modified:
  - src/components/analytics/AnalyticsPage.tsx
  - src/components/Navigation.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to Analytics tab from main navigation"
    - "Analytics page is lazy-loaded (not in main bundle)"
    - "User can select exercise to view progress chart"
    - "User can view week-over-week comparison cards"
    - "User can view all-time PR list for selected exercise"
  artifacts:
    - path: "src/components/analytics/AnalyticsPage.tsx"
      provides: "Main analytics container with exercise selector"
      contains: "useExerciseProgress"
      min_lines: 80
    - path: "src/components/Navigation.tsx"
      provides: "Navigation with Analytics tab"
      contains: "analytics"
    - path: "src/App.tsx"
      provides: "Lazy-loaded Analytics route"
      contains: "React.lazy"
  key_links:
    - from: "src/App.tsx"
      to: "src/components/analytics/AnalyticsPage.tsx"
      via: "React.lazy dynamic import"
      pattern: "lazy.*AnalyticsPage"
    - from: "src/components/analytics/AnalyticsPage.tsx"
      to: "src/hooks/useAnalytics.ts"
      via: "useExerciseProgress hook"
      pattern: "useExerciseProgress"
---

<objective>
Create Analytics page container and integrate into navigation with lazy loading.

Purpose: Completes the analytics feature by assembling chart components into a page, adding navigation, and implementing lazy loading to keep Recharts (~96KB) out of the main bundle. This delivers all Phase 5 success criteria.
Output: Fully functional Analytics tab accessible from main navigation.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-analytics-foundation/05-RESEARCH.md

# Existing navigation and app structure
@src/components/Navigation.tsx
@src/App.tsx

# Hooks from Plan 03
@src/hooks/useAnalytics.ts

# Components from Plan 04
@src/components/analytics/ExerciseProgressChart.tsx
@src/components/analytics/WeekComparisonCard.tsx
@src/components/analytics/PRListCard.tsx

# Exercises data
@src/hooks/useExercises.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnalyticsPage container component</name>
  <files>
    src/components/analytics/AnalyticsPage.tsx
  </files>
  <action>
Create src/components/analytics/AnalyticsPage.tsx:

```typescript
import { useState, useMemo } from 'react';
import { useExercises } from '../../hooks/useExercises';
import { useExerciseProgress, useWeeklyComparison } from '../../hooks/useAnalytics';
import { ExerciseProgressChart } from './ExerciseProgressChart';
import { WeekComparisonCard } from './WeekComparisonCard';
import { PRListCard } from './PRListCard';
import type { Exercise } from '../../types/exercise';

/**
 * Main Analytics page container
 * Provides exercise selector and displays progress charts, comparisons, and PRs
 */
export function AnalyticsPage() {
  const { exercises, isLoading: exercisesLoading } = useExercises();
  const [selectedExerciseId, setSelectedExerciseId] = useState<string>('');

  // Find selected exercise
  const selectedExercise = useMemo(
    () => exercises.find(e => e.exercise_id === selectedExerciseId),
    [exercises, selectedExerciseId]
  );

  // Fetch progress data for selected exercise
  const { data: progressData, isLoading: progressLoading } = useExerciseProgress({
    exerciseId: selectedExerciseId
  });

  // Fetch weekly comparison data
  const { data: weeklyData, isLoading: weeklyLoading } = useWeeklyComparison();

  // Filter weekly data for selected exercise
  const selectedWeeklyData = useMemo(
    () => weeklyData.filter(w => w.exerciseId === selectedExerciseId),
    [weeklyData, selectedExerciseId]
  );

  // Get current week comparison for selected exercise
  const currentWeekComparison = useMemo(() => {
    if (selectedWeeklyData.length === 0) return null;
    // First item is most recent week
    return selectedWeeklyData[0];
  }, [selectedWeeklyData]);

  // Auto-select first exercise when loaded
  if (!selectedExerciseId && exercises.length > 0 && !exercisesLoading) {
    setSelectedExerciseId(exercises[0].exercise_id);
  }

  if (exercisesLoading) {
    return (
      <div className="text-center py-12 text-zinc-500">
        Loading exercises...
      </div>
    );
  }

  if (exercises.length === 0) {
    return (
      <div className="text-center py-12 space-y-4">
        <p className="text-zinc-500">No exercises yet.</p>
        <p className="text-sm text-zinc-600">
          Create exercises and log workouts to see analytics.
        </p>
      </div>
    );
  }

  return (
    <div className="space-y-8">
      {/* Exercise Selector */}
      <div>
        <label htmlFor="exercise-select" className="block text-sm font-medium text-zinc-400 mb-2">
          Select Exercise
        </label>
        <select
          id="exercise-select"
          value={selectedExerciseId}
          onChange={(e) => setSelectedExerciseId(e.target.value)}
          className="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-4 py-3 text-zinc-100 focus:outline-none focus:ring-2 focus:ring-accent"
        >
          {exercises.map((exercise) => (
            <option key={exercise.exercise_id} value={exercise.exercise_id}>
              {exercise.name} ({exercise.muscle_group})
            </option>
          ))}
        </select>
      </div>

      {/* Progress Chart Section */}
      <section className="space-y-4">
        <h2 className="text-lg font-semibold text-zinc-200">
          Progress (Last 4 Weeks)
        </h2>
        {progressLoading ? (
          <div className="text-center py-8 text-zinc-500">Loading chart...</div>
        ) : (
          <div className="bg-zinc-800/30 rounded-lg p-4">
            <ExerciseProgressChart
              data={progressData}
              exerciseName={selectedExercise?.name || 'Exercise'}
              showVolume={true}
            />
          </div>
        )}
      </section>

      {/* Week Comparison Section */}
      <section className="space-y-4">
        <h2 className="text-lg font-semibold text-zinc-200">
          This Week vs Last Week
        </h2>
        {weeklyLoading ? (
          <div className="text-center py-8 text-zinc-500">Loading comparison...</div>
        ) : currentWeekComparison ? (
          <WeekComparisonCard data={currentWeekComparison} />
        ) : (
          <div className="text-center py-8 text-zinc-500">
            No data yet for this week. Log a workout to see comparison.
          </div>
        )}
      </section>

      {/* PR List Section */}
      <section className="space-y-4">
        <h2 className="text-lg font-semibold text-zinc-200">
          All-Time PRs
        </h2>
        {selectedExercise && (
          <PRListCard
            exerciseId={selectedExercise.exercise_id}
            exerciseName={selectedExercise.name}
          />
        )}
      </section>
    </div>
  );
}
```

Key requirements:
- Exercise selector dropdown at top
- Auto-select first exercise on load
- Show loading states for each section
- Empty states when no data exists
- Sections for progress chart, week comparison, and PRs
  </action>
  <verify>Run `npx tsc --noEmit` - should pass</verify>
  <done>AnalyticsPage renders with exercise selector and all chart sections</done>
</task>

<task type="auto">
  <name>Task 2: Update Navigation to include Analytics tab</name>
  <files>
    src/components/Navigation.tsx
  </files>
  <action>
Update src/components/Navigation.tsx to add Analytics tab:

```typescript
type Tab = 'workouts' | 'templates' | 'analytics' | 'settings';

interface NavigationProps {
  activeTab: Tab;
  onTabChange: (tab: Tab) => void;
}

export function Navigation({ activeTab, onTabChange }: NavigationProps) {
  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-zinc-900 border-t border-zinc-800">
      <div className="max-w-2xl mx-auto flex">
        <button
          onClick={() => onTabChange('workouts')}
          className={`flex-1 py-4 text-center text-sm font-medium transition-colors ${
            activeTab === 'workouts'
              ? 'text-accent border-t-2 border-accent -mt-px'
              : 'text-zinc-500 hover:text-zinc-300'
          }`}
        >
          Workouts
        </button>
        <button
          onClick={() => onTabChange('templates')}
          className={`flex-1 py-4 text-center text-sm font-medium transition-colors ${
            activeTab === 'templates'
              ? 'text-accent border-t-2 border-accent -mt-px'
              : 'text-zinc-500 hover:text-zinc-300'
          }`}
        >
          Templates
        </button>
        <button
          onClick={() => onTabChange('analytics')}
          className={`flex-1 py-4 text-center text-sm font-medium transition-colors ${
            activeTab === 'analytics'
              ? 'text-accent border-t-2 border-accent -mt-px'
              : 'text-zinc-500 hover:text-zinc-300'
          }`}
        >
          Analytics
        </button>
        <button
          onClick={() => onTabChange('settings')}
          className={`flex-1 py-4 text-center text-sm font-medium transition-colors ${
            activeTab === 'settings'
              ? 'text-accent border-t-2 border-accent -mt-px'
              : 'text-zinc-500 hover:text-zinc-300'
          }`}
        >
          Settings
        </button>
      </div>
    </nav>
  );
}

export type { Tab };
```

Key changes:
- Add 'analytics' to Tab type union
- Add Analytics button between Templates and Settings
- Maintain consistent button styling
  </action>
  <verify>Run `npx tsc --noEmit` - should pass</verify>
  <done>Navigation includes Analytics tab, Tab type includes 'analytics'</done>
</task>

<task type="auto">
  <name>Task 3: Integrate Analytics with lazy loading in App.tsx</name>
  <files>
    src/App.tsx
  </files>
  <action>
Update src/App.tsx to lazy-load Analytics page:

1. Add lazy import at top of file:
```typescript
import { useState, useEffect, lazy, Suspense } from 'react';
// ... other imports

// Lazy load Analytics page to keep Recharts (~96KB) out of main bundle
const AnalyticsPage = lazy(() => import('./components/analytics/AnalyticsPage').then(m => ({ default: m.AnalyticsPage })));
```

2. Update Tab type import (if needed):
```typescript
import { Navigation, type Tab } from './components/Navigation';
```

3. Update main content rendering (around line 225-227) to include analytics:
```typescript
{/* Main Content */}
<main className="max-w-2xl mx-auto px-6 py-10">
  {activeTab === 'settings' ? <BackupSettings /> :
   activeTab === 'analytics' ? (
     <Suspense fallback={<div className="text-center py-12 text-zinc-500">Loading analytics...</div>}>
       <AnalyticsPage />
     </Suspense>
   ) :
   activeTab === 'workouts' ? renderWorkoutsContent() : <TemplateList />}
</main>
```

Key requirements:
- Use React.lazy() for code splitting
- Wrap in Suspense with loading fallback
- Import as named export transformation ({ default: m.AnalyticsPage })
  </action>
  <verify>Run `npm run build` and check that analytics chunk is separate from main bundle</verify>
  <done>Analytics page lazy-loaded via React.lazy, Suspense provides loading state</done>
</task>

</tasks>

<verification>
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run build` succeeds
- [ ] Analytics chunk is separate from main bundle (check dist/assets)
- [ ] Navigation shows 4 tabs: Workouts, Templates, Analytics, Settings
- [ ] Clicking Analytics tab shows loading state then AnalyticsPage
- [ ] Exercise selector allows choosing different exercises
- [ ] Progress chart updates when exercise changes
- [ ] Week comparison shows current vs previous week metrics
- [ ] PR list shows for selected exercise
</verification>

<success_criteria>
Phase 5 Success Criteria Validation:
1. User can navigate to Analytics tab from main navigation - VERIFIED
2. User can view line chart showing weight progression over last 4 weeks - VERIFIED
3. User can view estimated 1RM trend line overlaid on exercise progress chart - VERIFIED
4. User can view total volume over time for each exercise - VERIFIED (showVolume={true})
5. User can view this week vs last week performance comparison - VERIFIED
6. User can view all-time PR list showing best lifts per exercise - VERIFIED
</success_criteria>

<output>
After completion, create `.planning/phases/05-analytics-foundation/05-05-SUMMARY.md`
</output>
