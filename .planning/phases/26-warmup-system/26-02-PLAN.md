---
phase: 26-warmup-system
plan: 02
type: execute
wave: 2
depends_on: ["26-01"]
files_modified:
  - src/components/workout/WarmupHint.tsx
  - src/components/workout/ExerciseView.tsx
  - src/components/settings/WarmupTierEditor.tsx
  - src/components/backup/BackupSettings.tsx
autonomous: true

must_haves:
  truths:
    - "Warmup-enabled exercises show tap-to-reveal warmup hints with calculated weights during logging"
    - "Bodyweight exercises (0kg) show no warmup hint"
    - "New exercises with no history show placeholder message"
    - "Users can edit warmup tier percentages and reps in Settings > Workout Preferences"
    - "Reset to defaults button restores 50%x5 and 75%x3"
  artifacts:
    - path: "src/components/workout/WarmupHint.tsx"
      provides: "Tap-to-reveal warmup display component"
      exports: ["WarmupHint"]
      min_lines: 40
    - path: "src/components/settings/WarmupTierEditor.tsx"
      provides: "Inline tier percentage/reps editor with reset button"
      exports: ["WarmupTierEditor"]
      min_lines: 30
    - path: "src/components/workout/ExerciseView.tsx"
      provides: "WarmupHint integrated between header and progress dots"
      contains: "WarmupHint"
    - path: "src/components/backup/BackupSettings.tsx"
      provides: "WarmupTierEditor nested in Workout Preferences section"
      contains: "WarmupTierEditor"
  key_links:
    - from: "src/components/workout/WarmupHint.tsx"
      to: "src/hooks/useWarmupData.ts"
      via: "useWarmupData hook call"
      pattern: "useWarmupData"
    - from: "src/components/workout/WarmupHint.tsx"
      to: "src/stores/useWorkoutStore.ts"
      via: "useWorkoutStore selector for warmupTiers"
      pattern: "useWorkoutStore.*warmupTiers"
    - from: "src/components/workout/WarmupHint.tsx"
      to: "src/utils/warmup.ts"
      via: "calculateWarmupSets call"
      pattern: "calculateWarmupSets"
    - from: "src/components/workout/ExerciseView.tsx"
      to: "src/components/workout/WarmupHint.tsx"
      via: "WarmupHint rendered with originalExerciseId prop"
      pattern: "WarmupHint.*originalExerciseId"
    - from: "src/components/settings/WarmupTierEditor.tsx"
      to: "src/stores/useWorkoutStore.ts"
      via: "useWorkoutStore for warmupTiers + setWarmupTiers + resetWarmupTiers"
      pattern: "setWarmupTiers|resetWarmupTiers"
---

<objective>
Build the warmup UI: tap-to-reveal warmup hints in the workout logging view and a tier configuration editor in Settings.

Purpose: Completes the warmup system by connecting the data layer (Plan 01) to user-facing components. Users see auto-calculated warmup weights during workouts and can customize tier percentages/reps in Settings.
Output: WarmupHint.tsx (workout UI), WarmupTierEditor.tsx (settings), plus integration into ExerciseView.tsx and BackupSettings.tsx.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/26-warmup-system/26-CONTEXT.md
@.planning/phases/26-warmup-system/26-RESEARCH.md
@.planning/phases/26-warmup-system/26-01-SUMMARY.md
@src/components/workout/ExerciseView.tsx
@src/components/workout/ExerciseNote.tsx
@src/components/backup/BackupSettings.tsx
@src/components/ui/Input.tsx
@src/utils/warmup.ts
@src/hooks/useWarmupData.ts
@src/stores/useWorkoutStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WarmupHint component and integrate into ExerciseView</name>
  <files>src/components/workout/WarmupHint.tsx, src/components/workout/ExerciseView.tsx</files>
  <action>
1. Create `src/components/workout/WarmupHint.tsx`:
   - Follow the ExerciseNote.tsx pattern exactly for tap-to-reveal with framer-motion (import `m, AnimatePresence` from 'framer-motion', use LazyMotion-compatible `m.div`)
   - Props: `{ originalExerciseId: string }`
   - Use `useWarmupData(originalExerciseId)` for maxWeight + isLoading
   - Use `useWorkoutStore(state => state.warmupTiers)` for tier config
   - Use `calculateWarmupSets(maxWeight, warmupTiers)` from utils/warmup
   - State: `isExpanded` (boolean, default false)
   - Check for reduced motion preference (same pattern as ExerciseNote.tsx)

   Rendering logic:
   - If isLoading: return null (don't show anything while querying)
   - If maxWeight === null (no history): show a collapsed "Warmup" button that expands to show "Log your first session to see warmup suggestions"
   - If maxWeight === 0 (bodyweight): return null entirely (skip warmup for bodyweight exercises)
   - Otherwise: show collapsed "Warmup" button that expands to show compact inline format:
     `"Warmup: 5x30kg (50%) -> 3x45kg (75%)"` (using arrow character)
     Format: `${set.reps}x${set.weight}kg (${set.percentage}%)`
     Join the two tiers with ` -> ` (using Unicode right arrow)

   Styling:
   - Collapsed button: `text-xs text-text-muted hover:text-accent transition-colors px-1 py-0.5`
   - Add aria-expanded attribute on button
   - Expanded content: `text-xs text-text-secondary py-1 px-1`
   - AnimatePresence with height 0->auto animation, duration 0.2s (or 0 if reduced motion)
   - Use overflow: hidden on animated div

2. Integrate into `src/components/workout/ExerciseView.tsx`:
   - Import WarmupHint from './WarmupHint'
   - Add `<WarmupHint originalExerciseId={planExercise.exercise_id} />` between the action buttons div (ending `</div>` after History button) and the progress indicator div (the dots). This positions warmup info in the exercise header area but below the action buttons.
   - Only render when `session` exists (same guard as SetGrid)
  </action>
  <verify>
Run `npx tsc --noEmit` -- zero TypeScript errors.
Run `npx vitest run` -- all existing tests pass.
Verify WarmupHint is rendered inside ExerciseView between action buttons and progress dots.
Verify WarmupHint imports useWarmupData, useWorkoutStore, and calculateWarmupSets.
  </verify>
  <done>
WarmupHint component renders tap-to-reveal warmup hints with calculated weights. Bodyweight exercises (0kg) show nothing. New exercises show placeholder. Component is integrated into ExerciseView between action buttons and progress dots.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create WarmupTierEditor and integrate into Settings</name>
  <files>src/components/settings/WarmupTierEditor.tsx, src/components/backup/BackupSettings.tsx</files>
  <action>
1. Create `src/components/settings/WarmupTierEditor.tsx`:
   - Import `useWorkoutStore` for warmupTiers, setWarmupTiers, resetWarmupTiers
   - Import `DEFAULT_WARMUP_TIERS` from utils/warmup
   - Import `Input` from '../ui/Input' (follow same pattern as BackupSettings.tsx rest timer input)

   Layout (follow the inline input pattern from Default Rest Timer in BackupSettings):
   - Label: "Warmup Tiers" (text-sm text-text-primary)
   - Two rows, one per tier:
     - Each row: "Tier {N}" label (text-xs text-text-muted, w-10) + percentage input (type="number", min=10, max=95, step=5, w-14) + "% x" text + reps input (type="number", min=1, max=20, step=1, w-14) + "reps" text
   - Use controlled inputs with local state (like restInput pattern) to avoid store thrashing on every keystroke
   - On blur of each input: validate (clamp to min/max), then call setWarmupTiers with updated tuple
   - "Reset to defaults" button: only visible when current values differ from DEFAULT_WARMUP_TIERS. Style: `text-xs text-accent hover:text-accent/80 transition-colors`. onClick calls resetWarmupTiers.
   - Compute `isDefault` by comparing all 4 values (tier1.percentage, tier1.reps, tier2.percentage, tier2.reps) against DEFAULT_WARMUP_TIERS

   Input styling: match existing Input component usage in BackupSettings -- `text-center text-sm [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none`

2. Integrate into `src/components/backup/BackupSettings.tsx`:
   - Import WarmupTierEditor from '../settings/WarmupTierEditor'
   - Add `<WarmupTierEditor />` inside the "Workout Preferences" CollapsibleSection, after the Sound toggle section (at the end of the Workout Preferences group)
   - Add a small separator before it: `<hr className="border-border-primary/30" />`
  </action>
  <verify>
Run `npx tsc --noEmit` -- zero TypeScript errors.
Run `npx vitest run` -- all existing tests pass.
Verify WarmupTierEditor appears in BackupSettings within the Workout Preferences section.
Verify Reset button only appears when values differ from defaults.
  </verify>
  <done>
WarmupTierEditor renders inline inputs for 2 warmup tiers (percentage + reps each) inside Settings > Workout Preferences. Reset to defaults button appears only when values are non-default. Values persist via useWorkoutStore.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npx vitest run` passes with no regressions
3. Start a workout with an exercise that has prior session history -- tap "Warmup" shows calculated weights in format "5x30kg (50%) -> 3x45kg (75%)"
4. Start a workout with a brand new exercise -- tap "Warmup" shows "Log your first session to see warmup suggestions"
5. Start a workout with a bodyweight exercise (0kg history) -- no warmup hint appears
6. Go to Settings > Workout Preferences > Warmup Tiers -- can edit percentage and reps for both tiers
7. Change tier values, refresh page -- values persist
8. Click "Reset to defaults" -- values return to 50%x5 and 75%x3
</verification>

<success_criteria>
- WarmupHint shows calculated warmup weights based on last session max weight
- WarmupHint skips bodyweight exercises (returns null for 0kg)
- WarmupHint shows placeholder for exercises with no history
- WarmupHint uses tap-to-reveal animation (framer-motion)
- WarmupTierEditor allows editing percentage (10-95) and reps (1-20) for 2 tiers
- Reset to defaults restores 50%x5 and 75%x3
- All existing tests pass, TypeScript compiles clean
</success_criteria>

<output>
After completion, create `.planning/phases/26-warmup-system/26-02-SUMMARY.md`
</output>
