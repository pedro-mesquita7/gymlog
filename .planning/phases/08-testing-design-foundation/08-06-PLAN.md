# Plan 08-06: Integration Tests & E2E Workout Flow

**Requirements:** TEST-03, TEST-04 (error boundary tests)
**Depends on:** 08-01 (testing infra), 08-03 (error boundaries exist to test)

## Goal

Write integration tests for the workout logging flow components and error boundaries using React Testing Library. Create a Playwright E2E test that verifies DuckDB-WASM initializes in a real Chromium browser and the core workout logging flow works end-to-end.

## Tasks

1. **Integration test: Error boundaries** at `src/components/ui/ErrorCard.test.tsx`
   - Test ErrorCard renders default "Something went wrong" message
   - Test "Show details" toggle reveals error info
   - Test "Try again" button calls resetErrorBoundary
   - Test FeatureErrorBoundary catches errors and renders ErrorCard
   - Create a `ThrowError` test helper component that throws on render

2. **Integration test: StartWorkout flow** at `src/components/workout/StartWorkout.test.tsx`
   - Render StartWorkout with mock gyms and templates arrays
   - Test: Start button disabled when no gym/template selected
   - Test: Selecting gym and template enables start button
   - Test: Clicking start calls startWorkout with correct IDs
   - Test: Empty state messages when no gyms or templates
   - Mock useWorkoutStore (only the startWorkout action)

3. **Integration test: SetLogger component** at `src/components/workout/SetLogger.test.tsx`
   - Render SetLogger with required props
   - Test: Log Set button disabled when weight=0 or reps=0
   - Test: Incrementing weight/reps via NumberStepper enables Log Set
   - Test: Clicking Log Set calls onLogSet with correct data
   - Test: After logging, reps reset to 0 (auto-advance behavior)
   - Mock useExerciseMax and useWorkoutStore

4. **Playwright E2E test** at `src/e2e/workout-flow.spec.ts`
   - Test 1: App loads and DuckDB initializes
     - Navigate to app URL
     - Verify the header "GymLog" appears (proves React rendered)
     - Verify no error messages visible (proves DuckDB connected)
     - Verify "events" counter appears or "demo mode" text (proves DB query ran)
   - Test 2: Full workout logging flow (if time permits)
     - Create a gym via the form
     - Create an exercise
     - Create a template
     - Start a workout
     - Log a set
     - Complete workout
     - Verify completion screen appears
   - Configure Playwright to use `webServer` to start dev server
   - Use Chromium only (OPFS requires secure context + SharedArrayBuffer)

## Verification
- [ ] `npm test` passes all unit + integration tests
- [ ] `npm run test:e2e` passes (DuckDB initializes in real Chromium)
- [ ] Error boundary integration tests confirm inline error recovery works
- [ ] StartWorkout and SetLogger integration tests cover core user interactions
- [ ] Total test count: 25+ tests across all files

## Files
- `src/components/ui/ErrorCard.test.tsx` (create)
- `src/components/workout/StartWorkout.test.tsx` (create)
- `src/components/workout/SetLogger.test.tsx` (create)
- `src/e2e/workout-flow.spec.ts` (create)
