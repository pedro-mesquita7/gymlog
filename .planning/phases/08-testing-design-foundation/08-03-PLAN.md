# Plan 08-03: Error Boundary System

**Requirements:** TEST-04
**Depends on:** 08-02 (uses design tokens for error UI styling)

## Goal

Implement granular error boundaries with inline error cards that replace broken sections while keeping the rest of the app usable. Each error card shows a simple message by default with an expandable "Show details" section and a retry button. Add error boundaries around the main feature areas: Workout, Templates, Analytics, and Settings.

## Tasks

1. **Install react-error-boundary**
   - `npm install react-error-boundary`

2. **Create `src/components/ui/ErrorCard.tsx`**
   - A reusable error fallback component that receives `error` and `resetErrorBoundary` props
   - Default message: "Something went wrong"
   - Expandable "Show details" toggle that reveals:
     - Error name and message
     - The query/component name if available (pass via context)
   - "Try again" button that calls `resetErrorBoundary()`
   - Styled using design tokens: error color border, bg-secondary background, rounded-lg
   - Compact and inline (NOT full-page) â€” just a card that replaces the broken section
   - Optional `title` prop for section context (e.g., "Analytics Error", "Workout Error")

3. **Create `src/components/ui/FeatureErrorBoundary.tsx`**
   - Wrapper around `react-error-boundary`'s `ErrorBoundary` component
   - Uses `ErrorCard` as fallback
   - Accepts `feature` prop (string) for context in error details
   - Logs errors to console.error (and optionally to localStorage for future Phase 11 observability)
   - `onError` callback stores last N errors (up to 20) in localStorage key `gymlog-error-log` with timestamp, feature name, error message

4. **Wrap feature sections in App.tsx with error boundaries**
   - Wrap `renderWorkoutsContent()` output (StartWorkout, ActiveWorkout) in `<FeatureErrorBoundary feature="Workouts">`
   - Wrap `<TemplateList>` in `<FeatureErrorBoundary feature="Templates">`
   - Wrap `<AnalyticsPage>` (inside Suspense) in `<FeatureErrorBoundary feature="Analytics">`
   - Wrap `<BackupSettings>` in `<FeatureErrorBoundary feature="Settings">`
   - Keep the existing DuckDB init error handling in App.tsx (full-page is appropriate for catastrophic DB failure)

5. **Test error boundary manually**
   - Temporarily throw an error in one component to verify:
     - Error card appears inline
     - Rest of app remains functional (other tabs work)
     - "Try again" button resets the boundary
     - "Show details" expands to show error info
   - Remove temporary error after verification

## Verification
- [ ] `npm run build` succeeds
- [ ] `ErrorCard` component exists at `src/components/ui/ErrorCard.tsx`
- [ ] `FeatureErrorBoundary` exists at `src/components/ui/FeatureErrorBoundary.tsx`
- [ ] App.tsx wraps each tab content in a `FeatureErrorBoundary`
- [ ] Error logging writes to `gymlog-error-log` in localStorage
- [ ] TypeScript compiles: `npx tsc --noEmit`

## Files
- `src/components/ui/ErrorCard.tsx` (create)
- `src/components/ui/FeatureErrorBoundary.tsx` (create)
- `src/App.tsx` (modify - wrap feature sections)
- `package.json` (modify - add react-error-boundary)
