---
phase: 04-data-durability
plan: 03
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified:
  - src/components/backup/BackupReminder.tsx
  - src/components/backup/BackupSettings.tsx
  - src/components/Navigation.tsx
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "User sees backup reminder banner after 10 workouts"
    - "User can dismiss the reminder banner"
    - "User can access backup settings from navigation"
    - "User can trigger export from settings UI"
    - "User can select and import file from settings UI"
    - "Import shows success/error feedback"
  artifacts:
    - path: "src/components/backup/BackupReminder.tsx"
      provides: "Dismissable backup reminder banner"
      exports: ["BackupReminder"]
    - path: "src/components/backup/BackupSettings.tsx"
      provides: "Export/Import UI controls"
      exports: ["BackupSettings"]
  key_links:
    - from: "src/components/backup/BackupReminder.tsx"
      to: "src/stores/useBackupStore.ts"
      via: "selectShouldShowReminder selector"
      pattern: "shouldShowReminder|BACKUP_THRESHOLD"
    - from: "src/components/backup/BackupSettings.tsx"
      to: "src/hooks/useBackupExport.ts"
      via: "exportBackup call"
      pattern: "exportBackup"
    - from: "src/components/backup/BackupSettings.tsx"
      to: "src/hooks/useBackupImport.ts"
      via: "importBackup call with file"
      pattern: "importBackup"
    - from: "src/App.tsx"
      to: "src/components/backup/BackupReminder.tsx"
      via: "Conditional render when shouldShowReminder"
      pattern: "BackupReminder"
---

<objective>
Create backup UI components and integrate them into the app.

Purpose: Give users a clear interface to export/import data and remind them to back up periodically.
Output: Working backup UI with reminder banner, settings page, and navigation integration.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-data-durability/04-RESEARCH.md
@.planning/phases/04-data-durability/04-01-SUMMARY.md
@.planning/phases/04-data-durability/04-02-SUMMARY.md
@src/App.tsx
@src/components/Navigation.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BackupReminder component</name>
  <files>src/components/backup/BackupReminder.tsx</files>
  <action>
Create dismissable banner component that shows when backup is due.

Component requirements:
1. Import useBackupStore and get: workoutsSinceBackup, dismissReminder
2. Import BACKUP_THRESHOLD from useBackupStore
3. Import useBackupExport for inline export action

UI structure (Tailwind classes matching existing app style):
```tsx
<div role="alert" className="bg-amber-900/30 border-b border-amber-700/50">
  <div className="max-w-2xl mx-auto px-6 py-3 flex items-center justify-between">
    <div className="flex items-center gap-3">
      {/* Warning icon */}
      <svg className="w-5 h-5 text-amber-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
      </svg>
      <p className="text-sm text-amber-200">
        {workoutsSinceBackup} workouts since last backup.
        <button onClick={handleExport} className="underline ml-1 hover:text-amber-100">
          Back up now
        </button>
      </p>
    </div>
    <button
      onClick={dismissReminder}
      aria-label="Dismiss reminder"
      className="text-amber-400 hover:text-amber-200 p-1"
    >
      <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
</div>
```

handleExport function:
- Call exportBackup() from useBackupExport
- Show loading state during export (disable button, show spinner or "Exporting...")
- On error, could show inline error or just let it fail silently (export hook handles errors)

Style: Match existing demo mode warning banner pattern in App.tsx for consistency.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>BackupReminder component created with dismiss and export actions</done>
</task>

<task type="auto">
  <name>Task 2: Create BackupSettings component</name>
  <files>src/components/backup/BackupSettings.tsx</files>
  <action>
Create settings component with export/import controls.

Component requirements:
1. Import useBackupExport for export functionality
2. Import useBackupImport for import functionality
3. Import useBackupStore for last backup date display
4. Import useDuckDB for event count display

UI structure:
```tsx
<div className="space-y-8">
  <section>
    <h2 className="text-lg font-semibold mb-4">Data Backup</h2>

    {/* Last backup info */}
    <div className="text-sm text-zinc-400 mb-4">
      {lastBackupDate
        ? `Last backup: ${new Date(lastBackupDate).toLocaleDateString()}`
        : 'No backups yet'}
      {' Â· '}{eventCount} events
    </div>

    {/* Export button */}
    <button
      onClick={exportBackup}
      disabled={isExporting}
      className="w-full py-3 px-4 bg-accent hover:bg-accent/90 disabled:bg-zinc-700 rounded-lg font-medium transition-colors"
    >
      {isExporting ? 'Exporting...' : 'Export Backup'}
    </button>

    {exportError && (
      <p className="mt-2 text-sm text-red-400">{exportError}</p>
    )}
  </section>

  <section>
    <h3 className="text-lg font-semibold mb-4">Restore from Backup</h3>

    {/* File input */}
    <input
      type="file"
      accept=".parquet"
      onChange={handleFileSelect}
      ref={fileInputRef}
      className="hidden"
    />

    <button
      onClick={() => fileInputRef.current?.click()}
      disabled={isImporting}
      className="w-full py-3 px-4 bg-zinc-800 hover:bg-zinc-700 disabled:bg-zinc-800/50 rounded-lg font-medium transition-colors"
    >
      {isImporting ? 'Importing...' : 'Import Backup'}
    </button>

    {/* Import result feedback */}
    {lastResult && (
      <div className={`mt-4 p-3 rounded-lg ${lastResult.success ? 'bg-green-900/30 text-green-200' : 'bg-red-900/30 text-red-200'}`}>
        {lastResult.success
          ? `Imported ${lastResult.eventsImported} events (${lastResult.eventsSkipped} duplicates skipped)`
          : lastResult.error}
      </div>
    )}
  </section>
</div>
```

handleFileSelect function:
- Get file from event.target.files[0]
- Call importBackup(file)
- Clear file input after import (to allow re-selecting same file)

Note: Keep UI simple - just export and import buttons with feedback. No complex settings for v1.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>BackupSettings component created with export/import buttons and feedback</done>
</task>

<task type="auto">
  <name>Task 3: Add settings tab to Navigation and integrate into App</name>
  <files>src/components/Navigation.tsx, src/App.tsx</files>
  <action>
Add a third "Settings" tab to navigation and render BackupSettings.

**Navigation.tsx changes:**
1. Update Tab type: `type Tab = 'workouts' | 'templates' | 'settings';`
2. Add third button for settings tab:
```tsx
<button
  onClick={() => onTabChange('settings')}
  className={`flex-1 py-4 text-center text-sm font-medium transition-colors ${
    activeTab === 'settings'
      ? 'text-accent border-t-2 border-accent -mt-px'
      : 'text-zinc-500 hover:text-zinc-300'
  }`}
>
  Settings
</button>
```

**App.tsx changes:**
1. Import BackupSettings from './components/backup/BackupSettings'
2. Import BackupReminder from './components/backup/BackupReminder'
3. Import useBackupStore and selectShouldShowReminder
4. Add selector: `const shouldShowReminder = useBackupStore(selectShouldShowReminder);`
5. Add BackupReminder banner after demo mode warning (conditional on shouldShowReminder AND status.isPersistent - no point backing up demo mode):
```tsx
{/* Backup reminder - only in persistent mode */}
{status.isPersistent && shouldShowReminder && <BackupReminder />}
```
6. Add settings tab rendering in main content:
```tsx
{activeTab === 'settings' ? <BackupSettings /> :
 activeTab === 'workouts' ? renderWorkoutsContent() : <TemplateList />}
```

Order in App.tsx render:
1. Header
2. Demo mode warning (if !isPersistent)
3. Backup reminder (if isPersistent && shouldShowReminder)
4. Main content (tab-dependent)
5. Navigation
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Settings tab accessible, BackupReminder shows when due, BackupSettings renders on settings tab</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify backup functionality</name>
  <what-built>Complete backup/restore flow with reminder banner and settings UI</what-built>
  <how-to-verify>
1. Start the dev server: `npm run dev`
2. Navigate to Settings tab - should see Export/Import buttons
3. Click "Export Backup" - should download a .parquet file
4. Check that file downloads with name like `gymlog-backup-2026-01-28.parquet`
5. Complete a workout (if you have gyms/templates set up)
6. After 10 workouts, backup reminder should appear (or temporarily change BACKUP_THRESHOLD to 1 for testing)
7. Test "Back up now" link in reminder - should trigger export
8. Test dismiss button - reminder should hide
9. Test import: select the exported parquet file, should show success message with counts
10. Verify localStorage has 'gymlog-backup' key with counter values
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Settings tab appears in navigation
3. Export downloads Parquet file
4. Import accepts Parquet file and shows result
5. Backup reminder appears after threshold workouts
6. Reminder can be dismissed
</verification>

<success_criteria>
- All UI components created and styled consistently
- Navigation has three tabs (Workouts, Templates, Settings)
- Backup reminder banner shows conditionally
- Export/Import work end-to-end
- Human verification confirms functionality
</success_criteria>

<output>
After completion, create `.planning/phases/04-data-durability/04-03-SUMMARY.md`
</output>
