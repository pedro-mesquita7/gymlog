---
phase: 03-history-analytics
plan: 07
type: execute
wave: 6
depends_on: ["03-05", "03-06"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can view exercise history showing last 2 weeks of sets"
    - "History respects global vs gym-specific rule"
    - "User sees automatic PR detection when new PR is set during logging"
    - "User can view estimated 1RM for exercises"
    - "User can view list of all PRs per exercise"
    - "dbt tests validate data quality"
    - "Anomaly detection flags unusual values"
---

<objective>
Verify all Phase 3 features work correctly through user acceptance testing.

Purpose: Confirms all HIST and DATA requirements are met before marking phase complete.
Output: Verified working History & Analytics features.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Phase 3: History & Analytics features including:
- Exercise history view (last 2 weeks, gym-specific filtering)
- Automatic PR detection during workout logging
- Estimated 1RM display (Epley formula)
- PR list per exercise
- dbt tests for data quality
- Anomaly detection for unusual weight jumps
  </what-built>
  <how-to-verify>
**Setup:**
1. Start dev server: `npm run dev`
2. Open app in browser

**Test 1: Exercise History (HIST-01, HIST-02)**
1. Create a gym and global exercise
2. Log several sets for the exercise in a workout
3. Navigate to the exercise history view
4. Verify: History shows sets from last 2 weeks
5. Verify: Sets display weight, reps, date, and any PR badges

**Test 2: PR Detection (HIST-03)**
1. Start a new workout
2. Log a set with higher weight than any previous set
3. Verify: PR notification appears (animated badge)
4. Verify: Notification auto-dismisses after ~3 seconds

**Test 3: Estimated 1RM (HIST-04)**
1. View an exercise with logged sets
2. Verify: Estimated 1RM displayed (using Epley formula)
3. Verify: 1RM only shown for sets with 1-15 reps

**Test 4: PR List (HIST-05)**
1. Navigate to PR list for an exercise
2. Verify: Shows all historical PRs
3. Verify: PRs show weight, reps, date, and PR type badge

**Test 5: Gym-Specific Filtering (HIST-02)**
1. Create a gym-specific exercise (is_global = false)
2. Log sets at Gym A
3. Log sets at Gym B
4. View history while at Gym A
5. Verify: Only Gym A sets appear (not Gym B)

**Test 6: Data Quality (DATA-05)**
1. Run `cd dbt && dbt test`
2. Verify: All tests pass (no negative weights, reps 1-100)

**Test 7: Anomaly Detection (DATA-11)**
1. Log a normal weight (e.g., 50kg)
2. Complete workout
3. Start new workout, log weight 50%+ higher (e.g., 80kg)
4. Verify: Anomaly indicator appears on the set

**Test 8: dbt Docs (DATA-06)**
1. Run `cd dbt && dbt docs generate`
2. Verify: catalog.json and manifest.json created
3. (Optional) Run `dbt docs serve` to view lineage graphs
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- [ ] HIST-01: History shows last 2 weeks of sets
- [ ] HIST-02: Gym-specific exercises filter correctly
- [ ] HIST-03: PR detection works during logging
- [ ] HIST-04: 1RM displayed correctly
- [ ] HIST-05: PR list shows all PRs per exercise
- [ ] DATA-05: dbt tests pass
- [ ] DATA-06: dbt docs generate succeeds
- [ ] DATA-10: Metrics (1RM, PR) calculated correctly
- [ ] DATA-11: Anomaly detection flags 50%+ changes
</verification>

<success_criteria>
All Phase 3 requirements verified through manual testing:
- Exercise history view working with gym filtering
- PR detection and notification during logging
- 1RM estimation displayed
- PR list accessible per exercise
- dbt tests and docs functioning
- Anomaly detection flagging unusual values
</success_criteria>

<output>
After completion, create `.planning/phases/03-history-analytics/03-07-SUMMARY.md`
</output>
