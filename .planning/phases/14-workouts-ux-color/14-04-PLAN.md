---
phase: 14-workouts-ux-color
plan: 04
type: execute
wave: 3
depends_on: ["14-02"]
files_modified:
  - src/components/rotation/QuickStartCard.tsx
  - src/components/workout/StartWorkout.tsx
  - src/components/workout/RecentWorkoutCard.tsx
  - src/hooks/useRecentWorkout.ts
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Quick Start card is the hero element at top of Workouts tab"
    - "One tap on Quick Start card starts the workout immediately"
    - "Manual template selection is collapsed behind a Browse all templates accordion"
    - "Recent workout summary card shows between Quick Start and accordion"
    - "Workouts tab shows more content above the fold with compact layout"
  artifacts:
    - path: "src/components/rotation/QuickStartCard.tsx"
      provides: "Hero Quick Start card with edit mode"
    - path: "src/components/workout/RecentWorkoutCard.tsx"
      provides: "Compact recent workout summary"
    - path: "src/hooks/useRecentWorkout.ts"
      provides: "Hook querying most recent completed workout data"
    - path: "src/components/workout/StartWorkout.tsx"
      provides: "Redesigned Workouts tab layout"
  key_links:
    - from: "src/components/workout/StartWorkout.tsx"
      to: "src/components/rotation/QuickStartCard.tsx"
      via: "Component composition"
      pattern: "QuickStartCard"
    - from: "src/components/workout/RecentWorkoutCard.tsx"
      to: "src/hooks/useRecentWorkout.ts"
      via: "Hook data fetch"
      pattern: "useRecentWorkout"
    - from: "src/hooks/useRecentWorkout.ts"
      to: "DuckDB SQL"
      via: "SQL query for recent workout"
      pattern: "fact_workouts"
---

<objective>
Redesign the Workouts tab for one-tap Quick Start prominence with compact layout, recent workout summary, and collapsed manual template selection.

Purpose: Users should open the Workouts tab and immediately see their next workout ready to start with one tap. Manual template/gym selection becomes secondary, collapsed behind an accordion. A recent workout summary card provides context between the hero and the accordion.

Output: Redesigned Workouts tab with Quick Start hero card, recent workout summary, and "Browse all templates" accordion. GymList and ExerciseList remain accessible below.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-workouts-ux-color/14-CONTEXT.md
@.planning/phases/14-workouts-ux-color/14-RESEARCH.md
@.planning/phases/14-workouts-ux-color/14-02-SUMMARY.md

Key source files:
@src/components/rotation/QuickStartCard.tsx
@src/components/workout/StartWorkout.tsx
@src/App.tsx
@src/stores/useRotationStore.ts
@src/stores/useWorkoutStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useRecentWorkout hook and RecentWorkoutCard</name>
  <files>
    src/hooks/useRecentWorkout.ts
    src/components/workout/RecentWorkoutCard.tsx
  </files>
  <action>
**useRecentWorkout.ts:**
Create a hook that queries the most recent completed workout from DuckDB. Follow the existing hook pattern (useExerciseProgress, useVolumeData, etc.) — use useDuckDB() to get the connection, run a SQL query, return the data.

SQL query should return:
- template_name (from dim_templates or inline COALESCE with 'Unknown Template')
- workout_date (formatted as relative: "Today", "Yesterday", "3 days ago", etc.)
- exercise_count (COUNT DISTINCT exercise_id from fact_sets)
- total_volume (SUM of weight * reps from fact_sets)
- duration_minutes (EXTRACT from started_at to completed_at)
- total_sets (COUNT from fact_sets)

Query pattern:
```sql
SELECT
  COALESCE(t.name, 'Unknown Template') as template_name,
  fw.started_at,
  fw.completed_at,
  COUNT(DISTINCT fs.exercise_id) as exercise_count,
  COALESCE(SUM(fs.weight_kg * fs.reps), 0) as total_volume,
  COUNT(fs.set_id) as total_sets
FROM fact_workouts fw
LEFT JOIN dim_templates t ON fw.template_id = t.template_id
LEFT JOIN fact_sets fs ON fw.workout_id = fs.workout_id
WHERE fw.status = 'completed'
GROUP BY fw.workout_id, t.name, fw.started_at, fw.completed_at
ORDER BY fw.started_at DESC
LIMIT 1
```

Return type: `{ templateName: string; date: string; exerciseCount: number; totalVolume: number; durationMinutes: number; totalSets: number } | null`

Use date-fns `formatDistanceToNow` or similar for the relative date string. Handle null gracefully (no recent workout = return null).

**RecentWorkoutCard.tsx:**
Create a compact summary card for the most recent workout. Design:
- Uses semantic token classes (bg-bg-secondary, text-text-*, border-border-primary)
- Compact: single row or two rows max
- Shows: template name (bold), relative date (muted), exercise count, total volume (kg), duration
- If no recent workout (null), render nothing (return null)
- Use the Card component or build with semantic classes directly

Example layout:
```
┌──────────────────────────────────────────┐
│ Last: Push Day A  ·  Yesterday           │
│ 5 exercises · 12 sets · 4,200 kg · 48m  │
└──────────────────────────────────────────┘
```

Keep it minimal — this is context, not a feature.
  </action>
  <verify>
Run `npx vitest run` — no test failures.
Run `npx vite build` — build succeeds (new files compile cleanly).
Verify no zinc-* classes: `grep -n "zinc-" src/hooks/useRecentWorkout.ts src/components/workout/RecentWorkoutCard.tsx` — zero matches.
  </verify>
  <done>useRecentWorkout hook queries last completed workout. RecentWorkoutCard renders compact summary with semantic tokens. Returns null gracefully when no data.</done>
</task>

<task type="auto">
  <name>Task 2: Redesign QuickStartCard as hero + restructure StartWorkout layout</name>
  <files>
    src/components/rotation/QuickStartCard.tsx
    src/components/workout/StartWorkout.tsx
    src/App.tsx
  </files>
  <action>
**QuickStartCard.tsx — Hero redesign with edit mode:**

Redesign the QuickStartCard to be the prominent hero element:
- Larger padding (p-6), bolder template name (text-2xl font-bold)
- Orange accent border (border-2 border-accent) — already has this
- Add edit mode: small edit icon button (pencil) in top-right corner
  - Default state: shows template name, gym name, position indicator, and one-tap "Start Workout" button
  - Edit mode (toggled by pencil icon): reveals gym select dropdown and template select dropdown above the start button. User can change gym/template, then tap "Start Workout" or tap pencil again to collapse.
  - Edit mode changes are local to this session — they don't change the rotation itself
- Keep all existing data-testid attributes (quick-start-card, btn-quick-start, rotation-info)
- Add data-testid="btn-edit-quick-start" to the edit toggle
- When no rotation configured: show "No workout plan yet" prompt with link text to Settings
- When no default gym: show "Set a default gym in Settings" prompt

**Props change:** QuickStartCard needs templates and gyms arrays for edit mode selectors. Already has them.

**StartWorkout.tsx — Layout restructure:**

Completely restructure to the new layout:
```
[Quick Start Hero Card]           ← existing QuickStartCard (now hero)
[Recent Workout Summary Card]     ← NEW RecentWorkoutCard
[Browse All Templates accordion]  ← NEW: <details>/<summary> wrapping gym+template selectors + start button
```

Import RecentWorkoutCard and useRecentWorkout.

Replace the current layout:
1. Remove the "or choose manually" divider
2. Remove the "Start Workout" heading section
3. Keep QuickStartCard at top (already there)
4. Add RecentWorkoutCard below QuickStartCard
5. Wrap the gym select, template select, and Start Workout button in a `<details>` element:
   ```html
   <details className="group">
     <summary className="cursor-pointer text-text-secondary hover:text-text-primary text-sm font-medium py-3 flex items-center gap-2">
       <span className="transition-transform group-open:rotate-90">▶</span>
       Browse all templates
     </summary>
     <div className="pt-4 space-y-4">
       {/* gym select, template select, start button — existing code */}
     </div>
   </details>
   ```
6. Use compact spacing throughout (space-y-4 instead of space-y-6, py-4 instead of py-8)

**App.tsx — Workouts tab layout:**

In `renderWorkoutsContent()`, the non-active-workout section currently renders:
```
<StartWorkout ... />
<GymList ... />
<ExerciseList ... />
```

Keep this structure but reduce the outer spacing from `space-y-12` to `space-y-8` for a more compact feel. GymList and ExerciseList stay below the workout section — they're management tools that belong under the main workout content.

**Preserve E2E test selectors:**
- data-testid="quick-start-card" (QuickStartCard)
- data-testid="btn-quick-start" (QuickStartCard start button)
- data-testid="rotation-info" (rotation position text)
- data-testid="gym-select" (gym dropdown — now inside accordion)
- data-testid="template-select" (template dropdown — now inside accordion)
- data-testid="btn-start-workout" (manual start button — now inside accordion)
  </action>
  <verify>
Run `npx vitest run` — all tests pass (StartWorkout.test.tsx especially).
Run `npx vite build` — build succeeds.
Run `grep -n "zinc-" src/components/rotation/QuickStartCard.tsx src/components/workout/StartWorkout.tsx` — zero matches.
Verify all data-testid preserved: `grep "data-testid" src/components/rotation/QuickStartCard.tsx src/components/workout/StartWorkout.tsx` — all 6 present.
  </verify>
  <done>QuickStartCard is hero with edit mode. StartWorkout uses compact layout with Quick Start hero, recent workout card, and collapsed Browse Templates accordion. All E2E selectors preserved.</done>
</task>

</tasks>

<verification>
1. `npx vite build` succeeds
2. `npx vitest run` — all tests pass including StartWorkout.test.tsx
3. Quick Start card is visually prominent hero element
4. Manual template selection collapsed behind accordion
5. Recent workout card shows between hero and accordion
6. All data-testid attributes preserved for E2E tests
7. Zero zinc-* references in modified files
</verification>

<success_criteria>
- Quick Start is primary CTA, hero element at top of Workouts tab (UX-01)
- Manual template selection collapsed behind "Browse all templates" (UX-01)
- Compact layout with less vertical space per element (UX-02)
- Recent workout summary provides context
- All E2E test selectors preserved
- Build and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/14-workouts-ux-color/14-04-SUMMARY.md`
</output>
