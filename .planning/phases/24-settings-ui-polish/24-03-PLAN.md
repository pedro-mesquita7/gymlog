---
phase: 24-settings-ui-polish
plan: 03
type: execute
wave: 2
depends_on: ["24-02"]
files_modified:
  - src/components/settings/RotationSection.tsx
autonomous: false

must_haves:
  truths:
    - "Active rotation is shown prominently with a colored 'Active' badge and expanded details"
    - "Non-active rotations are collapsed in an accordion and expandable on tap"
    - "Create New Rotation form is collapsed by default behind a '+' button in the section header"
    - "Switching active rotation uses inline confirmation ('Set as active?') not a modal"
    - "Rotation position info is visible for the active rotation"
  artifacts:
    - path: "src/components/settings/RotationSection.tsx"
      provides: "Redesigned rotation management with active-prominent UX"
      contains: "Active"
  key_links:
    - from: "src/components/settings/RotationSection.tsx"
      to: "src/stores/useRotationStore.ts"
      via: "setActiveRotation with inline confirmation"
      pattern: "setActiveRotation"
---

<objective>
Redesign the Rotation section UX to prioritize the active rotation. Active rotation is shown prominently at the top with details. Non-active rotations are collapsed in accordions. Create-new form is hidden behind a "+" button.

Purpose: During a workout, the user cares about their current rotation and position. The rotation section should surface this immediately without visual clutter from inactive rotations and the create form.
Output: Redesigned RotationSection.tsx with active-prominent, others-collapsed, create-collapsed layout.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-settings-ui-polish/24-RESEARCH.md
@.planning/phases/24-settings-ui-polish/24-02-SUMMARY.md
@src/components/settings/RotationSection.tsx
@src/stores/useRotationStore.ts
@src/components/ui/CollapsibleSection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign RotationSection with active-prominent UX</name>
  <files>
    src/components/settings/RotationSection.tsx
  </files>
  <action>
    Rewrite the RotationSection component layout. Keep all existing business logic (create, update, delete, reorder, setActive, resetPosition) but reorganize the visual presentation.

    **Remove the top-level h2** ("Workout Rotations") since this component is now inside a CollapsibleSection in BackupSettings (from Plan 02). If Plan 02's summary confirms this, remove it. If RotationSection is still standalone, keep the h2. Check the summary.

    **New layout structure:**

    1. **Section header with "+" button:**
       ```
       <div className="flex items-center justify-between mb-4">
         <h3 className="text-sm font-medium text-text-primary">
           {rotations.length > 0 ? `${rotations.length} rotation${rotations.length !== 1 ? 's' : ''}` : 'No rotations yet'}
         </h3>
         <button onClick={() => setShowCreateForm(!showCreateForm)} className="w-8 h-8 rounded-full bg-bg-tertiary flex items-center justify-center text-text-secondary hover:text-accent transition-colors">
           <span className={`text-lg transition-transform ${showCreateForm ? 'rotate-45' : ''}`}>+</span>
         </button>
       </div>
       ```
       - Add `showCreateForm` state (default: false)
       - The "+" rotates to "x" when form is open

    2. **Create form (collapsed by default):**
       - Conditionally render the create rotation form when `showCreateForm` is true
       - Keep existing form content (name input, plan selection checkboxes, Create button)
       - Add framer-motion AnimatePresence for smooth expand/collapse (optional, use if already imported)
       - On successful creation, auto-close the form: `setShowCreateForm(false)` in handleCreateRotation

    3. **Active rotation (always visible, prominent):**
       ```
       {activeRotation && (
         <div className="border border-accent/30 bg-bg-secondary rounded-xl p-4 space-y-3">
           <div className="flex items-center justify-between">
             <div>
               <h4 className="font-medium text-text-primary">{activeRotation.name}</h4>
               <p className="text-sm text-text-secondary mt-0.5">
                 Position {activeRotation.current_position + 1}/{activeRotation.template_ids.length} plans
               </p>
             </div>
             <span className="text-xs bg-accent text-white px-2.5 py-1 rounded-full font-medium">Active</span>
           </div>
           {/* Action buttons: Reset Position, Edit Order, Deactivate, Delete */}
           <div className="flex gap-2 flex-wrap">
             <Button size="sm" variant="secondary" onClick={() => resetPosition(activeRotation.rotation_id)}>Reset Position</Button>
             <Button size="sm" variant="ghost" onClick={() => toggleEditor(activeRotation.rotation_id)}>
               {editingRotationId === activeRotation.rotation_id ? 'Hide Editor' : 'Edit Order'}
             </Button>
             <Button size="sm" variant="secondary" onClick={() => setActiveRotation(null)}>Deactivate</Button>
             <Button size="sm" variant="danger" onClick={() => setDeleteConfirmId(activeRotation.rotation_id)}>Delete</Button>
           </div>
           {/* Drag-and-drop editor (same as current) */}
           {editingRotationId === activeRotation.rotation_id && (
             <RotationEditor templateIds={activeRotation.template_ids} plans={activePlans} onReorder={...} onRemove={...} />
           )}
           {/* Delete confirmation (same as current) */}
           {deleteConfirmId === activeRotation.rotation_id && (...)}
         </div>
       )}
       ```

    4. **Inactive rotations (each in a CollapsibleSection accordion):**
       ```
       {inactiveRotations.map(rotation => (
         <CollapsibleSection key={rotation.rotation_id} title={rotation.name}>
           <div className="space-y-3">
             <p className="text-sm text-text-secondary">
               {rotation.template_ids.length} plans Â· Position {rotation.current_position + 1}/{rotation.template_ids.length}
             </p>
             {/* Inline confirmation for "Set as active" */}
             {confirmingId === rotation.rotation_id ? (
               <div className="flex items-center gap-2">
                 <span className="text-sm text-text-secondary">Set as active?</span>
                 <Button size="sm" variant="primary" onClick={() => { setActiveRotation(rotation.rotation_id); setConfirmingId(null); }}>Yes</Button>
                 <Button size="sm" variant="ghost" onClick={() => setConfirmingId(null)}>No</Button>
               </div>
             ) : (
               <div className="flex gap-2 flex-wrap">
                 <Button size="sm" variant="primary" onClick={() => setConfirmingId(rotation.rotation_id)}>Set Active</Button>
                 <Button size="sm" variant="ghost" onClick={() => toggleEditor(rotation.rotation_id)}>Edit Order</Button>
                 <Button size="sm" variant="danger" onClick={() => setDeleteConfirmId(rotation.rotation_id)}>Delete</Button>
               </div>
             )}
             {/* Editor and delete confirm same as current */}
           </div>
         </CollapsibleSection>
       ))}
       ```

    Add new state variables:
    - `const [showCreateForm, setShowCreateForm] = useState(false);`
    - `const [confirmingId, setConfirmingId] = useState<string | null>(null);`

    Derive active/inactive rotations:
    - `const activeRotation = rotations.find(r => r.rotation_id === activeRotationId);`
    - `const inactiveRotations = rotations.filter(r => r.rotation_id !== activeRotationId);`

    Import CollapsibleSection from `../ui/CollapsibleSection`.

    Helper function for toggling editor:
    - `const toggleEditor = (id: string) => setEditingRotationId(editingRotationId === id ? null : id);`
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify no TypeScript errors.
    Run `npx vitest run` to verify existing tests still pass.
    Verify active rotation is rendered prominently: `grep "Active" src/components/settings/RotationSection.tsx` shows the badge.
    Verify inline confirmation exists: `grep "Set as active" src/components/settings/RotationSection.tsx` shows the confirmation prompt.
    Verify create form is collapsed: `grep "showCreateForm" src/components/settings/RotationSection.tsx` shows conditional rendering.
  </verify>
  <done>
    Active rotation displays prominently with colored border and "Active" badge. Inactive rotations are collapsed in accordions. Create form is hidden behind "+" button. Switching active rotation uses inline "Set as active?" confirmation.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 24 UI Polish: clean section headers, compact set logging, restructured settings with developer toggle, and redesigned rotation UX.
  </what-built>
  <how-to-verify>
    1. Open the app in mobile viewport (375px wide)
    2. Go to Settings tab:
       - Verify Default Gym dropdown is visible at top
       - Verify Active Rotation dropdown is visible below gym
       - Verify "Export Last Workout" button is visible
       - Scroll down: verify Workout Preferences, Data Backup, Restore, Manage Rotations are collapsible
       - Verify Developer Mode toggle is at the bottom, OFF by default
       - Toggle Developer Mode ON: System Observability, Data Quality, Demo Data sections should appear
       - Toggle Developer Mode OFF: those sections should disappear
       - Refresh page: Developer Mode should stay in its last state
    3. Go to Manage Rotations (expand it):
       - Verify active rotation shows prominently with "Active" badge
       - Verify inactive rotations are collapsed (tap to expand)
       - Verify "+" button for create new rotation, collapsed by default
       - Expand an inactive rotation and tap "Set Active" -- verify inline confirmation appears
    4. Start a workout and check set logging:
       - Verify set rows are compact (single line: number + inputs + remove)
       - Verify all planned sets are visible at once
       - Verify inputs are tappable (adequate touch targets)
    5. Go to Workouts tab:
       - Expand Exercises section: verify no redundant "Library / Exercises" subtitle inside
       - Expand Gyms section: verify no redundant "Locations / Your Gyms" subtitle inside
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npx vitest run` passes all existing tests
3. Active rotation is visually prominent with badge and border
4. Inactive rotations are collapsed accordions
5. Create form collapsed behind "+" button
6. Inline confirmation for rotation switching (not modal)
7. No redundant headers in any expanded section
</verification>

<success_criteria>
- Rotation section shows active rotation prominently, others in collapsed accordions
- Create new rotation is hidden behind "+" button
- Inline "Set as active?" confirmation works
- Human verification checkpoint confirms all Phase 24 requirements visually
</success_criteria>

<output>
After completion, create `.planning/phases/24-settings-ui-polish/24-03-SUMMARY.md`
</output>
