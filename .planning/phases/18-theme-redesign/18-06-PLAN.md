---
phase: 18-theme-redesign
plan: 06
type: execute
wave: 3
depends_on: ["18-02", "18-03", "18-04", "18-05"]
files_modified:
  - src/index.css
autonomous: false

must_haves:
  truths:
    - "All text-on-background combinations meet WCAG AA 4.5:1 contrast ratio"
    - "Large text (18px+ or 14px+ bold) meets WCAG AA 3:1 contrast ratio"
    - "No rounded-lg remains anywhere in src/ (except rounded-full which is intentional)"
    - "App visually matches the soft/modern dark aesthetic described in phase context"
  artifacts:
    - path: "src/index.css"
      provides: "Contrast-verified OKLCH tokens"
      contains: "--color-text-muted"
  key_links:
    - from: "src/index.css text tokens"
      to: "src/index.css background tokens"
      via: "OKLCH lightness difference must produce >= 4.5:1 ratio"
      pattern: "--color-text.*--color-bg"
---

<objective>
Verify WCAG AA contrast ratios for all text/background combinations, audit for any remaining rounded-lg instances, fix any contrast failures, and get visual sign-off from the user.

Purpose: THEME-04 requirement demands WCAG AA compliance. This final plan catches any contrast regressions from the warm palette shift and performs the comprehensive audit that proves the theme redesign is complete.
Output: Contrast-verified tokens, zero rounded-lg remaining, user-approved visual result.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/18-theme-redesign/18-CONTEXT.md
@.planning/phases/18-theme-redesign/18-01-SUMMARY.md
@src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: WCAG contrast audit and final rounded-lg sweep</name>
  <files>src/index.css</files>
  <action>
**Part A: WCAG AA Contrast Verification**

Calculate contrast ratios for ALL text/background combinations using the OKLCH relative luminance formula. The key combinations to verify:

1. text-primary on bg-primary (body text): MUST be >= 4.5:1
2. text-primary on bg-secondary (text on cards): MUST be >= 4.5:1
3. text-primary on bg-tertiary (text on inputs): MUST be >= 4.5:1
4. text-secondary on bg-primary: MUST be >= 4.5:1
5. text-secondary on bg-secondary: MUST be >= 4.5:1
6. text-muted on bg-primary: MUST be >= 4.5:1 (this is the tightest constraint)
7. text-muted on bg-secondary: MUST be >= 4.5:1
8. text-muted on bg-tertiary: MUST be >= 3:1 (large text context)
9. accent on bg-primary: >= 3:1 (used for large interactive elements)
10. accent on bg-secondary: >= 3:1

**Method:** Use the OKLCH lightness values. Convert to sRGB to calculate relative luminance, then compute contrast ratio = (L1 + 0.05) / (L2 + 0.05).

If any combination fails:
- Adjust the failing token's lightness value (usually increase text lightness or decrease background lightness)
- Re-verify all combinations after adjustment
- Document the adjustments made

**Part B: Final rounded-lg Sweep**

Run: `grep -r "rounded-lg" src/` (excluding node_modules, dist, test files)

For any remaining `rounded-lg` instances:
- If in a component file (.tsx): Replace with rounded-2xl (cards) or rounded-xl (inputs/buttons)
- If in index.css @theme: This is the token definition -- should now be 1rem, which is correct
- If in a test file: Leave as-is (tests don't affect visual)

**Part C: Build Verification**

Run `npm run build` and verify no errors. Run `npm test` to ensure no regressions.
  </action>
  <verify>
1. `npm run build` succeeds
2. `npm test` passes (or existing test failures are pre-existing, not caused by theme changes)
3. `grep -r "rounded-lg" src/components/ src/App.tsx` returns 0 matches
4. All 10 contrast combinations verified >= required ratio
  </verify>
  <done>All text/background combinations meet WCAG AA. No rounded-lg in component files. Build and tests pass.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete warm/soft dark theme redesign across the entire app: warm OKLCH tokens, rounded corners (16px cards, 12px inputs), card shadows, warm navigation bar with pill indicators, updated chart styling, migrated hardcoded colors, WCAG AA verified contrast.</what-built>
  <how-to-verify>
    1. Run `npm run dev` and open the app in the browser
    2. Check the overall feel: backgrounds should be warm (slightly brownish dark, not cool blue-gray)
    3. Verify cards have visibly rounded corners (16px) and subtle shadows
    4. Navigate between all 4 tabs -- Navigation bar should have warm background with rounded pill active indicator
    5. Open a template and check the builder -- rounded corners on exercise rows
    6. Start a workout -- batch logging grid should have softened cells
    7. Go to Analytics tab -- charts should have warm tooltip backgrounds, muscle heat map should use warm colors
    8. Check Settings tab -- all sections should have rounded cards
    9. Verify text is readable on all backgrounds (WCAG AA compliance)
    10. Check that accent colors (orange buttons, green PRs, red errors) are still vivid/saturated
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 18, or describe visual issues to address.</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `npm test` passes
3. No rounded-lg in any component file
4. WCAG AA contrast verified for all text/background combinations
5. User visually approves the warm theme
</verification>

<success_criteria>
- WCAG AA contrast ratios verified and documented (4.5:1 for body text, 3:1 for large text)
- Zero rounded-lg instances remaining in src/components/ and src/App.tsx
- Build and tests pass
- User approves the visual result
</success_criteria>

<output>
After completion, create `.planning/phases/18-theme-redesign/18-06-SUMMARY.md`
</output>
