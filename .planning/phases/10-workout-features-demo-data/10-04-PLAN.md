---
phase: 10-workout-features-demo-data
plan: 04
type: execute
wave: 3
depends_on: ["10-01"]
files_modified:
  - src/db/demo-data.ts
  - src/utils/clearAllData.ts
  - src/components/settings/DemoDataSection.tsx
  - src/components/backup/BackupSettings.tsx
autonomous: true

must_haves:
  truths:
    - "Portfolio reviewer can click Load Demo Data and immediately see 6 weeks of realistic workout history"
    - "Demo data includes gyms, exercises, templates, rotation config, and workout history with progressive overload"
    - "User sees warning before demo data replaces existing data"
    - "User sees empty state after clearing data (no workouts, exercises, gyms visible in UI)"
  artifacts:
    - path: "src/db/demo-data.ts"
      provides: "Demo data generation with 6 weeks of realistic workouts"
      exports: ["loadDemoData"]
    - path: "src/utils/clearAllData.ts"
      provides: "Full application reset utility"
      exports: ["clearAllData"]
    - path: "src/components/settings/DemoDataSection.tsx"
      provides: "Settings UI for demo data and clear all"
      exports: ["DemoDataSection"]
  key_links:
    - from: "src/db/demo-data.ts"
      to: "src/db/events.ts"
      via: "writeEvent calls for all demo events"
      pattern: "writeEvent"
    - from: "src/utils/clearAllData.ts"
      to: "src/db/duckdb-init.ts"
      via: "getDuckDB for table drops + OPFS cleanup"
      pattern: "getDuckDB|navigator\\.storage"
    - from: "src/components/settings/DemoDataSection.tsx"
      to: "src/db/demo-data.ts"
      via: "loadDemoData on button click"
      pattern: "loadDemoData"
    - from: "src/components/backup/BackupSettings.tsx"
      to: "src/components/settings/DemoDataSection.tsx"
      via: "DemoDataSection rendered in Settings"
      pattern: "DemoDataSection"
---

<objective>
Create demo data generation (6 weeks of realistic workouts) and clear-all-data utility. Portfolio reviewers can one-click load demo data to see the app's full analytics capabilities. Users can also clear all data to reset the app.

Purpose: PORT-01 (one-click demo data for portfolio). Demonstrates progressive overload, plateaus, deloads, PRs -- triggers all analytics features.
Output: loadDemoData utility, clearAllData utility, DemoDataSection in Settings.
</objective>

<execution_context>
@/home/dev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-workout-features-demo-data/10-RESEARCH.md
@.planning/phases/10-workout-features-demo-data/10-CONTEXT.md
@src/db/events.ts
@src/db/duckdb-init.ts
@src/stores/useRotationStore.ts
@src/stores/useWorkoutStore.ts
@src/stores/useBackupStore.ts
@src/stores/useProgressionAlertStore.ts
@src/components/backup/BackupSettings.tsx
@src/types/events.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create demo data generator and clearAllData utility</name>
  <files>
    src/db/demo-data.ts
    src/utils/clearAllData.ts
  </files>
  <action>
NOTE: This task creates two closely related utilities in the same task because clearAllData is called before loadDemoData (they share the same flow). The demo-data.ts file will be the larger of the two (~120-150 lines) due to workout generation logic. Keep helper functions (e.g., generateSetsForExercise) small and focused.

**clearAllData.ts:**
Full application reset that clears ALL persistence layers:
1. Get DuckDB instance, drop events table: `DROP TABLE IF EXISTS events`
2. Clear OPFS files: navigate to root via `navigator.storage.getDirectory()`, remove `gymlog.db` and `gymlog.db.wal`
3. Clear ALL localStorage keys: `gymlog-workout`, `gymlog-rotations`, `gymlog-backup`, `gymlog-progression-alerts`
4. Call `window.location.reload()` to reinitialize everything
- Wrap each step in try/catch so partial failures don't block cleanup
- Export: `async function clearAllData(): Promise<void>`

**demo-data.ts:**
Generate and write 6 weeks of realistic workout data. Export: `async function loadDemoData(): Promise<void>`

**Demo setup (gyms, exercises, templates):**
- 1 gym: "Iron Works Gym" with location "Downtown"
- 8-10 exercises covering upper/lower split:
  - Upper: Bench Press, Overhead Press, Barbell Row, Lat Pulldown, Dumbbell Curl
  - Lower: Squat, Romanian Deadlift, Leg Press, Leg Curl, Calf Raise
- 4 templates forming Upper/Lower rotation:
  - Upper A: Bench Press, Barbell Row, Overhead Press, Dumbbell Curl (4 exercises)
  - Lower A: Squat, Romanian Deadlift, Leg Curl, Calf Raise
  - Upper B: Overhead Press, Lat Pulldown, Bench Press, Dumbbell Curl
  - Lower B: Leg Press, Romanian Deadlift, Squat, Calf Raise

**Write setup events** (gym_created, exercise_created, template_created, template_exercise_added) using writeEvent from events.ts. Use uuidv7() for IDs. Use date-fns subDays to create timestamps starting 42 days ago.

**Workout generation -- 6 weeks, 4 sessions per week (~24 workouts):**
Schedule: Mon/Wed/Fri/Sun pattern (days 0, 2, 4, 6 of each week)
Template rotation: Upper A -> Lower A -> Upper B -> Lower B (repeating)

Progressive overload pattern per exercise:
```typescript
const DEMO_SCHEDULE = [
  { week: 1, pattern: 'baseline',    multiplier: 1.0 },
  { week: 2, pattern: 'progression', multiplier: 1.05 },
  { week: 3, pattern: 'progression', multiplier: 1.10 },
  { week: 4, pattern: 'plateau',     multiplier: 1.10 },  // Same as week 3
  { week: 5, pattern: 'deload',      multiplier: 0.90 },
  { week: 6, pattern: 'resume',      multiplier: 1.15 },  // New PRs
];
```

Base weights (kg): Bench 60, OHP 40, Row 55, Lat Pulldown 50, Curl 15, Squat 80, RDL 70, Leg Press 120, Leg Curl 30, Calf Raise 40

Per workout, per exercise: 3-4 sets, 8-12 reps. Adjust weight by week multiplier, round to 2.5kg increments. Slight rep variation (first set full reps, last set -1 or -2). RIR: 2 for first sets, 0-1 for last set.

**For each workout, write events in order:**
1. `workout_started` with realistic timestamp (vary hours: 7am, 6pm, 10am patterns)
2. `set_logged` for each set (3-4 per exercise, 4 exercises per template = 12-16 sets)
3. `workout_completed` with timestamp ~45-75 min after start

**After all workouts written, set up rotation in localStorage:**
- Create rotation "Upper Lower 4x" with the 4 template IDs
- Set as active rotation with current_position at a mid-point (e.g., position 2)
- Set default gym to the demo gym
- Write directly to localStorage key `gymlog-rotations` with proper Zustand persist format:
  ```json
  { "state": { "rotations": [...], "activeRotationId": "...", "defaultGymId": "..." }, "version": 0 }
  ```

**Important:**
- Use date-fns subDays, addHours, addMinutes for all timestamp math
- Ensure chronological order of events (earlier timestamps first)
- Use string interpolation for SQL (per project convention)
- Do NOT call checkpoint() after every event -- call it once at the end for performance
  </action>
  <verify>
`npx tsc --noEmit` passes. Import both functions in a test file or verify manually.
  </verify>
  <done>
loadDemoData writes ~24 workouts with realistic progressive overload patterns spanning 6 weeks. clearAllData drops all tables, clears OPFS, clears localStorage, and reloads.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Demo Data section to Settings page</name>
  <files>
    src/components/settings/DemoDataSection.tsx
    src/components/backup/BackupSettings.tsx
  </files>
  <action>
**DemoDataSection.tsx:**
Settings section with "Load Demo Data" and "Clear All Data" buttons.

**Load Demo Data button:**
- Text: "Load Demo Data"
- Subtitle: "Load 6 weeks of sample workouts to explore all features"
- On click: show confirmation dialog (use native window.confirm or a state-based confirmation)
  - If user has existing data (check eventCount > 0): warn "This will replace all existing data. Continue?"
  - If confirmed: call clearAllData-like cleanup (drop table, clear localStorage) THEN call loadDemoData(), then reload
- Show loading state: "Loading demo data..." with disabled button
- Props: needs eventCount to detect existing data

**Clear All Data button:**
- Text: "Clear All Data" in danger/red styling
- Subtitle: "Remove all workouts, exercises, gyms, and settings"
- On click: confirm "Are you sure? This cannot be undone."
- If confirmed: call clearAllData()
- Use Button variant="danger" or red styling (bg-error/10 text-error border border-error/30)

**Layout:**
```tsx
<section>
  <h2 className="text-lg font-semibold mb-4">Demo & Data Management</h2>
  <div className="space-y-4">
    {/* Load Demo Data card */}
    {/* Clear All Data card */}
  </div>
</section>
```

**BackupSettings.tsx:**
- Import DemoDataSection
- Add it as a new section at the BOTTOM of Settings (after Restore from Backup)
- Add `<hr className="border-border-primary" />` separator before it
- Pass eventCount prop from useDuckDB hook (already available in BackupSettings)
  </action>
  <verify>
`npx tsc --noEmit` passes. `npx vitest run` passes. In browser: Settings shows "Demo & Data Management" section with both buttons. Click "Load Demo Data" -- app reloads with demo data visible in all tabs. Click "Clear All Data" -- app reloads empty.
  </verify>
  <done>
Settings page has Load Demo Data and Clear All Data buttons. Demo data loads 6 weeks of realistic workouts. Clear All Data wipes everything and reloads to clean state.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npx vitest run` passes
3. Load Demo Data: app shows gyms, exercises, templates, workout history, analytics with trends
4. Analytics page shows: progression charts, volume trends, plateau detection triggering
5. Clear All Data: app returns to empty state, no orphaned localStorage
6. Load Demo Data with existing data: warning shown first, then data replaced
</verification>

<success_criteria>
- loadDemoData creates full demo setup (~24 workouts, 6 weeks, progressive overload with plateau and deload)
- clearAllData wipes DuckDB + OPFS + all localStorage stores and reloads
- Settings page has both buttons with confirmation dialogs
- Demo data triggers all analytics features (volume trends, progression detection, PR history)
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/10-workout-features-demo-data/10-04-SUMMARY.md`
</output>
